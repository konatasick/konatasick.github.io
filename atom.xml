<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Konata Tech Blog</title>
  
  <subtitle>No bug no life!</subtitle>
  <link href="https://tech.konata.co/atom.xml" rel="self"/>
  
  <link href="https://tech.konata.co/"/>
  <updated>2022-02-23T06:01:36.075Z</updated>
  <id>https://tech.konata.co/</id>
  
  <author>
    <name>Konata Izumi</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Docker éƒ¨ç½²çš„ mastodon åœ¨å®¹å™¨å†… debug</title>
    <link href="https://tech.konata.co/2022-02-23-mastodon-debug-in-container/"/>
    <id>https://tech.konata.co/2022-02-23-mastodon-debug-in-container/</id>
    <published>2022-02-23T05:54:28.000Z</published>
    <updated>2022-02-23T06:01:36.075Z</updated>
    
    <content type="html"><![CDATA[<p>æ„Ÿè°¢å°æŸ æª¬ @<a href="mailto:&#x6c;&#x65;&#x6d;&#111;&#x6e;&#64;&#x6e;&#121;&#97;&#46;&#x6c;&#x65;&#109;&#111;&#110;&#x61;&#x64;&#x65;&#x2e;&#109;&#x6f;&#101;">&#x6c;&#x65;&#x6d;&#111;&#x6e;&#64;&#x6e;&#121;&#97;&#46;&#x6c;&#x65;&#109;&#111;&#110;&#x61;&#x64;&#x65;&#x2e;&#109;&#x6f;&#101;</a> ç”¨è‡ªå·±çš„å®ä¾‹æµ‹è¯•ç ”ç©¶å‡ºè¿™å¥—å¯è¡Œæ–¹æ¡ˆï¼</p><p>ä¸€ä¸ªç®€çŸ­çš„è§£é‡Šï¼Œæ™šç‚¹æˆ‘å†™è¯¦ç»†ä¸€ç‚¹ã€‚</p><p>édockerçš„é­”æ”¹æ–¹æ³•ï¼š</p><p><a href="https://pullopen.github.io/%E8%BF%9B%E9%98%B6%E9%AD%94%E6%94%B9/2020/11/14/mastodon-modify.html">https://pullopen.github.io/%E8%BF%9B%E9%98%B6%E9%AD%94%E6%94%B9/2020/11/14/mastodon-modify.html</a></p><p>ä¿®æ”¹åè¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RAILS_ENV=production bundle exec rails assets:precompile</span><br><span class="line">systemctl restart mastodon-sidekiq</span><br><span class="line">systemctl reload mastodon-web</span><br><span class="line">systemctl restart mastodon-streaming</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„docker é­”æ”¹æ–¹å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mastodon_web_1 /bin/bash </span><br></pre></td></tr></table></figure><p>è¿›å…¥containeræ”¹ä»£ç ï¼Œç„¶åç¼–è¯‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RAILS_ENV=production bundle exec rails assets:precompile</span><br></pre></td></tr></table></figure><p>è¿™æ­¥ä¸æŠ¥é”™ä¹‹åexité€€å‡ºï¼Œç„¶åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure><p>å³å¯ä»£æ›¿é‚£å‡ å¥systemctl restartã€‚</p><p>å¦‚æœæœ‰500ä¹‹ç±»çš„æŠ¥é”™å¯ä»¥å‚è€ƒï¼š</p><p><a href="https://blog.tantalum.life/posts/how-to-run-your-mastodon-by-docker/#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%82%E5%BA%94">https://blog.tantalum.life/posts/how-to-run-your-mastodon-by-docker/#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%82%E5%BA%94</a></p><p>æˆ‘æš‚æ—¶æ²¡æœ‰é‡åˆ°ã€‚</p><p>æœ¬æ–¹æ³•é€‚åˆè¿›å…¥dockerè¿›è¡Œä¸€äº›è°ƒè¯•å¹¶ä¸”å¯ä»¥å¿«é€Ÿåœ¨ç½‘é¡µç«¯çœ‹åˆ°ä¿®æ”¹ç»“æœï¼Œç¡®è®¤æ— è¯¯åè¿˜æ˜¯æ¨èæ‰“åŒ…æˆé•œåƒå†<code>docker-compose down/up -d</code>ã€‚</p><p>å»ºè®®çš„workflowæ˜¯ï¼š</p><ul><li>åœ¨dockerä¸­çƒ­ä¿®ä»£ç å¹¶restart</li><li>ç¡®è®¤ä»£ç okä¹‹ååœ¨å®¹å™¨å¤–ä¿®æ”¹ä»£ç å¹¶èµ°ä¼ é•œåƒçš„æµç¨‹è¿›è¡Œæ­£å¼æ›´æ–°ï¼Œå³ï¼š</li></ul><p><a href="https://pullopen.github.io/%E8%BF%9B%E9%98%B6%E9%AD%94%E6%94%B9/2020/11/01/Mastodon-on-Docker-2.html">https://pullopen.github.io/%E8%BF%9B%E9%98%B6%E9%AD%94%E6%94%B9/2020/11/01/Mastodon-on-Docker-2.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ„Ÿè°¢å°æŸ æª¬ @&lt;a href=&quot;mailto:&amp;#x6c;&amp;#x65;&amp;#x6d;&amp;#111;&amp;#x6e;&amp;#64;&amp;#x6e;&amp;#121;&amp;#97;&amp;#46;&amp;#x6c;&amp;#x65;&amp;#109;&amp;#111;&amp;#110;&amp;#x61;&amp;#x64;&amp;#x65;&amp;#x2e;&amp;#1</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="Mastodon" scheme="https://tech.konata.co/tags/Mastodon/"/>
    
    <category term="Docker" scheme="https://tech.konata.co/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Crontab å„ç§è¿è¡Œä¸æˆåŠŸå’Œè§£å†³æ–¹æ³•</title>
    <link href="https://tech.konata.co/2022-02-22-crontab-debug/"/>
    <id>https://tech.konata.co/2022-02-22-crontab-debug/</id>
    <published>2022-02-21T17:37:15.000Z</published>
    <updated>2022-02-21T17:49:35.557Z</updated>
    
    <content type="html"><![CDATA[<p>Crontabæ˜¯ä¸€ä¸ªè¿è¡Œå®šæ—¶è„šæœ¬çš„å·¥å…·ï¼Œæˆ‘åœ¨è¿™é‡Œç¿»è½¦äº†næ¬¡ï¼Œè®°å½•ä¸€ä¸‹debugè¿‡ç¨‹ã€‚</p><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service cron status # æŸ¥çœ‹è¿è¡ŒçŠ¶æ€å’ŒæŠ¥é”™ä¿¡æ¯</span><br><span class="line">service cron reload # é‡æ–°è½½å…¥ </span><br><span class="line">service cron restart # é‡å¯</span><br><span class="line">vim /etc/crontab #ç¼–è¾‘ crontab</span><br></pre></td></tr></table></figure><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><h3 id="Missing-newline-before-EOF"><a href="#Missing-newline-before-EOF" class="headerlink" title="Missing newline before EOF"></a>Missing newline before EOF</h3><p>æŠ¥é”™å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(*system*) ERROR (Missing newline before EOF, this crontab file will be ignored)</span><br></pre></td></tr></table></figure><p><a href="https://cronitor.io/cron-reference/missing-newline-before-eof#:~:text=Fixing%20missing%20newline%20before%20EOF%20errors.%20Correct%20this,always%20added%20and%20are%20not%20%20incorrectly%20stripped.">è§£å†³æ–¹æ¡ˆ</a></p><blockquote><p>Correct this error simply by <strong>adding a blank line</strong> at the end of your crontab. </p></blockquote><p>å°±æ˜¯åœ¨crontabæ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæ–°çš„ç©ºè¡Œï¼ˆå›è½¦ï¼‰ï¼Œå°±ç¦»è°±â€¦â€¦</p><h3 id="session-opened-for-user-root-by-uid-x3D-0"><a href="#session-opened-for-user-root-by-uid-x3D-0" class="headerlink" title="session opened for user root by (uid&#x3D;0)"></a>session opened for user root by (uid&#x3D;0)</h3><p>æŠ¥é”™å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pam_unix(cron:session): session opened for user root by (uid=0)</span><br></pre></td></tr></table></figure><p><a href="https://www.digitalocean.com/community/questions/weird-cron-logs-appearing-for-no-reasion">è§£å†³æ–¹æ¡ˆ</a>ï¼š</p><p>æ‰“å¼€æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pam.d/common-session-noninteractive</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°è¿™ä¸€è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session required pam_unix.so</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨å…¶ä¸Šæ–¹æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session [success=1 default=ignore] pam_succeed_if.so service in cron quiet use_uid</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service cron restart</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Crontabæ˜¯ä¸€ä¸ªè¿è¡Œå®šæ—¶è„šæœ¬çš„å·¥å…·ï¼Œæˆ‘åœ¨è¿™é‡Œç¿»è½¦äº†næ¬¡ï¼Œè®°å½•ä¸€ä¸‹debugè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¸¸ç”¨å‘½ä»¤&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨å‘½ä»¤&quot;&gt;&lt;/a&gt;å¸¸ç”¨å‘½ä»¤&lt;/h2&gt;&lt;figure class=&quot;</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="Docker" scheme="https://tech.konata.co/tags/Docker/"/>
    
    <category term="Crontab" scheme="https://tech.konata.co/tags/Crontab/"/>
    
    <category term="Linux" scheme="https://tech.konata.co/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ç»™ Hexo é…ç½® Giscus è¯„è®ºç³»ç»Ÿ</title>
    <link href="https://tech.konata.co/2022-02-20-add-comment-to-hexo/"/>
    <id>https://tech.konata.co/2022-02-20-add-comment-to-hexo/</id>
    <published>2022-02-20T10:14:45.000Z</published>
    <updated>2022-02-20T10:14:45.143Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç½‘ä¸Šçœ‹åˆ°åˆ«äººå®¶çš„åšå®¢æœ‰GitHubç™»é™†è¯„è®ºçš„åŠŸèƒ½ï¼Œç«‹åˆ»è¡¨ç¤ºï¼šâ€œæˆ‘ä¹Ÿè¦ï¼â€</p><p>ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯nextè‡ªå¸¦çš„gitalkè®¾ç½®ï¼Œç„¶è€Œåœ¨æˆ‘çš„ä¸€ç•ªåŠªåŠ›ä¸‹ä¾ç„¶æ²¡æœ‰é…å¥½ï¼Œäºæ˜¯æ¢æˆäº†Giscusï¼Œå‚è€ƒ<a href="https://blog.southfox.me/2022/01/%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%94%AF%E6%8C%81%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/">Giscusçš„ä¼˜ç‚¹</a>ã€‚</p><p>Giscusçš„é…ç½®éå¸¸ç®€å•ï¼æŒ‰ç…§ä¸Šæ–‡çš„é¡ºåºé…å¥½äº†ä»¥åï¼Œå¡åœ¨æœ€åä¸€æ­¥â€œåµŒå…¥åˆ°åšå®¢æ–‡ç« æ¨¡æ¿åº•éƒ¨â€ï¼Œäºæ˜¯æœåˆ°äº†<a href="https://github.com/next-theme/hexo-next-giscus">è¿™ä¸ªæ’ä»¶</a>ï¼Œå®‰è£…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-next-giscus --save</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ hexo çš„ _config.yml æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">giscus:</span><br><span class="line">  enable: false</span><br><span class="line">  repo: # Github repository name</span><br><span class="line">  repo_id: # Github repository id</span><br><span class="line">  category: # Github discussion category</span><br><span class="line">  category_id: # Github discussion category id</span><br><span class="line">  # Available values: pathname | url | title | og:title</span><br><span class="line">  mapping: pathname</span><br><span class="line">  # Available values: 0 | 1 </span><br><span class="line">  reactions_enabled: 1</span><br><span class="line">   # Available values: 0 | 1 </span><br><span class="line">  emit_metadata: 1</span><br><span class="line">  # Available values: light | dark | dark_high_contrast | transparent_dark | preferred-color-scheme</span><br><span class="line">  theme: light</span><br><span class="line">  # Available values: en | zh-C</span><br><span class="line">  lang: en</span><br><span class="line">  # Available value: anonymous</span><br><span class="line">  crossorigin: anonymous</span><br></pre></td></tr></table></figure><p>æŠŠ<code>enable: false</code>æ”¹ä¸º<code>true</code>ï¼Œå¹¶å‚è€ƒ<a href="https://giscus.app/zh-CN">Giscus</a>ç”Ÿæˆçš„è„šæœ¬çš„å…ƒç´ ä¾æ¬¡å¡«å…¥è®¾ç½®ã€‚</p><p>ä¸€å¼€å§‹æ˜¯åœ¨<code>_config.next.yml</code>ä¸èµ·ä½œç”¨ï¼Œä¸çŸ¥ä¸ºä½•ã€‚</p><p>æœ€åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure><p>åˆ·æ–°é¡µé¢åå°±å¯ä»¥çœ‹åˆ°è¯„è®ºé¡µé¢å•¦ï¼</p><p>å¿«æ¥ç»™æˆ‘è¯„è®ºå§ï½ï½</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨ç½‘ä¸Šçœ‹åˆ°åˆ«äººå®¶çš„åšå®¢æœ‰GitHubç™»é™†è¯„è®ºçš„åŠŸèƒ½ï¼Œç«‹åˆ»è¡¨ç¤ºï¼šâ€œæˆ‘ä¹Ÿè¦ï¼â€&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯nextè‡ªå¸¦çš„gitalkè®¾ç½®ï¼Œç„¶è€Œåœ¨æˆ‘çš„ä¸€ç•ªåŠªåŠ›ä¸‹ä¾ç„¶æ²¡æœ‰é…å¥½ï¼Œäºæ˜¯æ¢æˆäº†Giscusï¼Œå‚è€ƒ&lt;a href=&quot;https://blog.southfox.me/2022</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="Hexo" scheme="https://tech.konata.co/tags/Hexo/"/>
    
    <category term="Next" scheme="https://tech.konata.co/tags/Next/"/>
    
    <category term="Giscus" scheme="https://tech.konata.co/tags/Giscus/"/>
    
  </entry>
  
  <entry>
    <title>Mastodon åª’ä½“å­˜å‚¨å’Œæ•°æ®åº“å¤‡ä»½</title>
    <link href="https://tech.konata.co/2022-02-20-mastodon-backup/"/>
    <id>https://tech.konata.co/2022-02-20-mastodon-backup/</id>
    <published>2022-02-19T16:19:10.000Z</published>
    <updated>2022-02-22T11:54:37.044Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢ï¼š</strong><br>æœ¬æ–‡å¤‡ä»½æ–¹æ³•æˆ‘è¿˜åœ¨éªŒè¯ä¸­ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼Œæœ€å¥½ä»¥é˜²ä¸‡ä¸€å¤šå¯¼å‡ºä¸€ä»½<code>backup.dump</code> ã€‚</p><h2 id="Whyï¼šä¸ºä»€ä¹ˆè¦å¤‡ä»½"><a href="#Whyï¼šä¸ºä»€ä¹ˆè¦å¤‡ä»½" class="headerlink" title="Whyï¼šä¸ºä»€ä¹ˆè¦å¤‡ä»½"></a>Whyï¼šä¸ºä»€ä¹ˆè¦å¤‡ä»½</h2><p>å®šæœŸå¤‡ä»½æ˜¯å¥½ä¹ æƒ¯ï¼Œè‡ªä»ä½“éªŒè¿‡ä¸€æ¬¡wordpressæ¬å®¶ä»¥åæ·±åˆ»æ„Ÿå—åˆ°ï¼Œæœ‰ï¼ˆå¼‚åœ°ï¼‰å¤‡ä»½èµ°éå¤©ä¸‹éƒ½ä¸æ€•ã€‚å› ä¸ºå„ç§æ•™å¤‡ä»½çš„èµ„æ–™éƒ½æ¯”è¾ƒå…¨ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯ä¸ªäººè®°å½•+å­¦ä¹ ç”¨ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£å¤‡ä»½ç©¶ç«Ÿåœ¨åšä»€ä¹ˆä¹Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚</p><p>å½“ä½ æœ‰ä¸€ä»½é•¿æ¯›è±¡çš„å¼‚åœ°å¤‡ä»½ï¼Œä½ å¯ä»¥ï¼š</p><ul><li>è¿ç§»ç«™ç‚¹åˆ°å…¶ä»–æœåŠ¡å™¨</li><li>åœ¨æœåŠ¡å™¨å®Œå…¨ç˜«ç—ªæ—¶æˆ–ä¸å°å¿ƒé‡è£…åï¼Œä¾ç„¶å¯ä»¥è¿˜åŸæ‰€æœ‰æ•°æ®åº“å†…å®¹</li></ul><h2 id="Whatï¼šå¤‡ä»½å“ªäº›å†…å®¹"><a href="#Whatï¼šå¤‡ä»½å“ªäº›å†…å®¹" class="headerlink" title="Whatï¼šå¤‡ä»½å“ªäº›å†…å®¹"></a>Whatï¼šå¤‡ä»½å“ªäº›å†…å®¹</h2><p>ä¿—è¯è¯´å¾—å¥½ï¼Œæ²¡æœ‰ç»è¿‡æ£€éªŒçš„å¤‡ä»½ä¸æ˜¯å¥½å¤‡ä»½ã€‚é‚£ä¹ˆæœ€å¿«è®©æˆ‘ä»¬æ¸…æ¥šéœ€è¦å¤‡ä»½ä»€ä¹ˆçš„æ–¹å¼å°±æ˜¯çœ‹è¿˜åŸ&#x2F;è¿ç§»ç«™ç‚¹éœ€è¦ä»€ä¹ˆã€‚</p><p>è¿™é‡Œå‚è€ƒäº†<a href="https://pullopen.github.io/%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/2020/10/21/migrate-Mastodon-to-Docker.html">édockerç«™ç‚¹è¿ç§»åˆ°docker</a> å’Œ <a href="https://blog.tantalum.life/posts/migrate-mastodon-to-docker/">dockerè¿ç§»åˆ°docker</a> ä¸¤ç¯‡èµ„æ–™ï¼Œå¤§è‡´ä¸Šåˆ†ä¸ºä¸‰æ­¥ï¼š</p><h3 id="1-è½¬ç§»é…ç½®æ–‡ä»¶"><a href="#1-è½¬ç§»é…ç½®æ–‡ä»¶" class="headerlink" title="1. è½¬ç§»é…ç½®æ–‡ä»¶"></a>1. è½¬ç§»é…ç½®æ–‡ä»¶</h3><p>é…ç½®æ–‡ä»¶ä¹Ÿå°±æ˜¯ä½ çš„mastodonå®‰è£…ç›®å½•ï¼ˆæŒ‰ç…§pullopençš„æ•™ç¨‹çš„è¯åº”è¯¥æ˜¯<code>/home/mastodon/mastodon</code>ï¼‰ä¸‹çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.env.production </span><br><span class="line">docker-compose.yml </span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯åœ¨æ›´æ”¹ç«™ç‚¹è®¾ç½®ä¸­æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–‡ä»¶ã€‚</p><h3 id="2-è½¬ç§»æ•°æ®åº“"><a href="#2-è½¬ç§»æ•°æ®åº“" class="headerlink" title="2. è½¬ç§»æ•°æ®åº“"></a>2. è½¬ç§»æ•°æ®åº“</h3><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li><p>é€šè¿‡å¤‡ä»½æ–‡ä»¶<code>backup.dump</code> è¿›è¡Œè½¬ç§»ï¼Œä¹Ÿå°±æ˜¯å¤‡ä»½çš„æœ€å…³é”®å†…å®¹ï¼Œé€šå¸¸é€šè¿‡<code>pg_dump</code>å¯¼å‡ºå¤‡ä»½ï¼Œå†é€šè¿‡<code>pg_restore</code>è¿›è¡Œè¿˜åŸã€‚</p></li><li><p>å¦‚æœæ˜¯dockerï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶<code>./postgres/</code>å’Œ<code>./redis/</code>ï¼Œå¹¶å¯¹<code>./postgres/</code>èµ‹æƒï¼Œå‚è€ƒ<a href="https://pullopen.github.io/%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/2020/10/21/migrate-Mastodon-to-Docker.html">å°†ç«™ç‚¹ä»Dockerè¿ç§»è‡³Docker</a></p></li></ul><h3 id="3-è½¬ç§»åª’ä½“æ–‡ä»¶"><a href="#3-è½¬ç§»åª’ä½“æ–‡ä»¶" class="headerlink" title="3. è½¬ç§»åª’ä½“æ–‡ä»¶"></a>3. è½¬ç§»åª’ä½“æ–‡ä»¶</h3><p>è¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå¦‚æœä½ å·²ç»é…ç½®äº†åª’ä½“æ–‡ä»¶åœ¨äº‘å­˜å‚¨ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸éœ€è¦çš„ã€‚å¦‚æœä½ æ²¡æœ‰é…ç½®è¿‡ï¼Œé‚£ä¹ˆä½ çš„æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨<code>./public/system/</code>ç›®å½•ä¸‹ã€‚å…·ä½“è€Œè¨€æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cd /home/mastodon/mastodon/public/system</span><br><span class="line">$ du -h --max-depth=1</span><br><span class="line">9.6M    ./media_attachments</span><br><span class="line">3.3G    ./cache</span><br><span class="line">20M     ./custom_emojis</span><br><span class="line">13M     ./accounts</span><br><span class="line">3.4G    .</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>./cache</code>æ˜¯å¤–ç«™å­˜å‚¨ï¼Œå…¶ä»–éƒ½æ˜¯æœ¬ç«™çš„æ•°æ®ã€‚æˆ‘ä»¬å½“ç„¶å¸Œæœ›é™¤äº†å¤–ç«™å­˜å‚¨ä»¥å¤–ï¼Œå¯¹æœ¬ç«™çš„æ‰€æœ‰æ•°æ®éƒ½åšå¥½å¤‡ä»½ã€‚</p><p>å…³äºå®šæœŸæ¸…é™¤å¤–ç«™å­˜å‚¨ï¼Œè¯·å‚è€ƒ<a href="https://moe.cat/@AstroProfundis/104527119128844099">è¿™ä¸ªå˜Ÿæ–‡</a>ï¼Œæˆ‘çš„crontabè®¾ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">30 4    * * *   root    docker exec mastodon_web_1 tootctl media remove --days=14 &gt;&gt; /home/mastodon/log/mastodon/all.log 2&gt;&amp;1</span><br><span class="line">30 4    * * *   root    docker exec mastodon_web_1 tootctl media remove-orphans &gt;&gt; /home/mastodon/log/mastodon/all.log 2&gt;&amp;1</span><br><span class="line">30 4    * * *   root    docker exec mastodon_web_1 tootctl statuses remove --days=180 &gt;&gt; /home/mastodon/log/mastodon/all.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>æˆ‘æ˜¯ç›´æ¥å¯åŠ¨å®¹å™¨æ‰§è¡Œtootctlå‘½ä»¤ï¼Œæ›´å¤šç›¸å…³å†…å®¹å¯ä»¥é€šè¿‡<a href="https://mantyke.icu/2022/mastodon-media-file-cleanup/">ä½¿ç”¨è„šæœ¬çš„tootctl</a>æˆ–è€…<a href="https://www.notion.so/3f645c4a2ab14f34aef37703ee286d3a#d9a3235086fc44ceb3293cf26100a5ae">édockerå®‰è£…çš„tootctl</a>äº†è§£ã€‚</p><p><strong>æ€»ç»“ï¼šå¦‚æœæ˜¯dockerçš„è¯ï¼Œç›´æ¥å¯¹é™¤<code>./public/system/cache</code>ä»¥å¤–æ•´ä¸ªæ–‡ä»¶å¤¹å’Œä¸ªåˆ«é…ç½®æ–‡ä»¶è¿›è¡Œå¤‡ä»½å³å¯ã€‚</strong></p><h2 id="Whereï¼šå¤‡ä»½æ”¾åœ¨å“ªé‡Œ"><a href="#Whereï¼šå¤‡ä»½æ”¾åœ¨å“ªé‡Œ" class="headerlink" title="Whereï¼šå¤‡ä»½æ”¾åœ¨å“ªé‡Œ"></a>Whereï¼šå¤‡ä»½æ”¾åœ¨å“ªé‡Œ</h2><h3 id="æœ¬åœ°å¤‡ä»½"><a href="#æœ¬åœ°å¤‡ä»½" class="headerlink" title="æœ¬åœ°å¤‡ä»½"></a>æœ¬åœ°å¤‡ä»½</h3><p>æœ¬æ–‡å°†å¤‡ä»½æ–‡ä»¶å’Œå¤‡ä»½è„šæœ¬éƒ½æ”¾åœ¨<code>/opt/mastodon-backup</code> ä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä»»ä½•ä½ å–œæ¬¢çš„å®‰å…¨ä½ç½®ã€‚</p><h3 id="å¼‚åœ°å¤‡ä»½"><a href="#å¼‚åœ°å¤‡ä»½" class="headerlink" title="å¼‚åœ°å¤‡ä»½"></a>å¼‚åœ°å¤‡ä»½</h3><p>æœ€å¥½çš„å¤‡ä»½ä¸€å®šæ˜¯å¼‚åœ°å¤‡ä»½ã€‚<a href="https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/10/19/Mastodon-on-Docker.html#%E5%88%A9%E7%94%A8scaleway%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93">pullopen</a> å’Œ <a href="https://www.notion.so/0f154999939e44109a5827e6c542fb53">o3o</a> éƒ½æ¨èäº†Scalewayäº‘å¤‡ä»½ï¼Œå¹¶é™„ä¸Šäº†è¯¦ç»†çš„èµ„æ–™ã€‚</p><h2 id="Whenï¼šä»€ä¹ˆæ—¶å€™å¤‡ä»½"><a href="#Whenï¼šä»€ä¹ˆæ—¶å€™å¤‡ä»½" class="headerlink" title="Whenï¼šä»€ä¹ˆæ—¶å€™å¤‡ä»½"></a>Whenï¼šä»€ä¹ˆæ—¶å€™å¤‡ä»½</h2><p>å»ºè®®è®¾ç½®æ¯å¤©æ™šä¸Šè‡ªåŠ¨å¤‡ä»½ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨crontabåˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚</p><h2 id="Whoï¼šè°æ¥å¤‡ä»½"><a href="#Whoï¼šè°æ¥å¤‡ä»½" class="headerlink" title="Whoï¼šè°æ¥å¤‡ä»½"></a>Whoï¼šè°æ¥å¤‡ä»½</h2><p>å½“ç„¶æ˜¯ç«™é•¿å•Šè¿˜æœ‰è°ï¼</p><h2 id="Howï¼šå¦‚ä½•å¤‡ä»½"><a href="#Howï¼šå¦‚ä½•å¤‡ä»½" class="headerlink" title="Howï¼šå¦‚ä½•å¤‡ä»½"></a>Howï¼šå¦‚ä½•å¤‡ä»½</h2><p>å•°å—¦äº†è¿™ä¹ˆä¹…ç»ˆäºåˆ°äº†è¿™ä¸€æ­¥ï¼Œæˆ‘åªæ˜¯å¸Œæœ›åœ¨æˆ‘çœŸæ­£æ“ä½œä¹‹å‰èƒ½å¤Ÿæ˜ç™½æˆ‘åœ¨åšä»€ä¹ˆã€‚</p><p>è¿™ä¸€èŠ‚è„šæœ¬ä¸»è¦å‚è€ƒ<a href="https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/10/19/Mastodon-on-Docker.html#%E5%88%A9%E7%94%A8scaleway%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93">åˆ©ç”¨Scalewayå¤‡ä»½æ•°æ®åº“</a> ã€‚</p><h3 id="æœ¬åœ°å¤‡ä»½-1"><a href="#æœ¬åœ°å¤‡ä»½-1" class="headerlink" title="æœ¬åœ°å¤‡ä»½"></a>æœ¬åœ°å¤‡ä»½</h3><p>åªçœ‹è„šæœ¬çš„å‰åŠéƒ¨åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">source /etc/profile</span><br><span class="line">now=$(date &quot;+%Y%m%d-%H%M%S&quot;)</span><br><span class="line">origin=&quot;/home/mastodon/mastodon&quot;</span><br><span class="line">target=&quot;scaleway:ä½ çš„bucketåå­—&quot;</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; now starting export&quot;</span><br><span class="line">/usr/bin/docker exec pgå®¹å™¨å pg_dump -U postgres -Fc mastodon_production &gt; $&#123;origin&#125;/backup.dump &amp;&amp;</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; succeed and upload to s3 now&quot;</span><br><span class="line">/usr/bin/zip -P å¯†ç  $&#123;origin&#125;/backup_$&#123;now&#125;.zip $&#123;origin&#125;/backup.dump</span><br></pre></td></tr></table></figure><p>å‰é¢å®šä¹‰äº†ä¸€äº›è·¯å¾„å’Œæ—¶é—´ç­‰ï¼Œå…ˆé€šè¿‡<code>pg_dump</code>å¯¼å‡º<code>backup.dump</code>ï¼Œå†å°†å…¶åŠ å¯†å‹ç¼©ä¸º<code>backup_$&#123;now&#125;.zip</code>ï¼Œä½†ä»ä¸Šæ–‡å¯è§ï¼Œå¯¹äºdockerå®‰è£…çš„æƒ…å†µï¼Œç›´æ¥copyæ–‡ä»¶å¤¹å³å¯ï¼Œæ‰€ä»¥æˆ‘å¯¹è¿™éƒ¨åˆ†åšäº†ä¸€äº›æ”¹åŠ¨å¹¶å‚è€ƒ<a href="https://www.notion.so/0f154999939e44109a5827e6c542fb53#59063f5382174e638fc529602d810d32">o3oçš„é…ç½®å¤‡ä»½è„šæœ¬</a>ï¼Œå¢åŠ äº†ä¸€äº›å…³é”®ä¿¡æ¯çš„å¤‡ä»½ï¼Œæˆ‘çš„å®Œæ•´<strong>æœ¬åœ°å¤‡ä»½</strong>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># Save this file at  /opt/mastodon-backup/backup_local.sh</span><br><span class="line"># Set a cronjob:  0 5 * * * root /bin/bash /opt/mastodon-backup/backup_local.sh &gt; /opt/mastodon-backup/logs/backup_local.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># Set backup_folder and name</span><br><span class="line">now=$(date &quot;+%Y%m%d-%H%M%S&quot;)</span><br><span class="line">origin_folder=&quot;/home/mastodon/mastodon&quot;</span><br><span class="line">backup_folder=&quot;/opt/mastodon-backup/dbbackup&quot;</span><br><span class="line"></span><br><span class="line"># Clean up old backup file</span><br><span class="line">rm -r $&#123;backup_folder&#125;/*</span><br><span class="line"></span><br><span class="line"># Generating a mastodon backup exclude cache</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; now starting export&quot;</span><br><span class="line">/usr/bin/zip -P å¯†ç  -rqx=$&#123;origin_folder&#125;/public/system/cache/* $&#123;backup_folder&#125;/backup_$&#123;now&#125;.zip $&#123;origin_folder&#125;</span><br><span class="line"></span><br><span class="line"># Copying important files</span><br><span class="line">cp -r /etc/nginx/sites-available $&#123;backup_folder&#125;</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; done!&quot;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å•ç‹¬è¿è¡Œä¸€æ¬¡è„šæœ¬çœ‹çœ‹æ˜¯å¦æ­£ç¡®å¤‡ä»½ï¼Œè¿è¡ŒåæŸ¥çœ‹å¤‡ä»½ç›®å½•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ls /opt/mastodon-backup/dbbackup/ -lh</span><br><span class="line">total 76M</span><br><span class="line">-rw-r--r-- 1 root root  76M Feb 20 00:09 backup_20220220-000931.zip</span><br><span class="line">drwxr-xr-x 2 root root 4.0K Feb 20 00:09 sites-available</span><br></pre></td></tr></table></figure><p>æˆ‘å°†è¿™ä¸ªè„šæœ¬å­˜ä¸º<code>backup_local.sh</code>ï¼Œåœ¨æˆ‘é…ç½®å¥½Scalewayä¹‹å‰å®ˆæŠ¤æˆ‘çš„æ•°æ®ï¼Œå°†å…¶æ”¾åœ¨crontabä¸‹å®šæœŸè¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 5 * * * root /bin/bash /opt/mastodon-backup/backup_local.sh.sh &gt; /opt/mastodon-backup/logs/backup_local.sh.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>å¤‡ä»½æ—¶é—´è®¾åœ¨æ¸…é™¤å¤–éƒ¨ç¼“å­˜åŠå°æ—¶åã€‚</p><h3 id="å¼‚åœ°å¤‡ä»½-1"><a href="#å¼‚åœ°å¤‡ä»½-1" class="headerlink" title="å¼‚åœ°å¤‡ä»½"></a>å¼‚åœ°å¤‡ä»½</h3><p>å†çœ‹åŸè„šæœ¬çš„ååŠéƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/rclone copy $&#123;origin&#125;/backup_$&#123;now&#125;.zip $&#123;target&#125; &amp;&amp;</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; ok all done&quot;</span><br><span class="line">rm -f $&#123;origin&#125;/backup.dump $&#123;origin&#125;/backup_$&#123;now&#125;.zip</span><br><span class="line">/usr/bin/rclone --min-age 7d  delete $&#123;target&#125;</span><br></pre></td></tr></table></figure><p><code>rclone copy</code>æ˜¯å°†å‹ç¼©åçš„å¤‡ä»½æ–‡ä»¶æŒ‰ç…§é…ç½®å¥½çš„è®¾ç½®ä¸Šä¼ è‡³Scalewayï¼Œä¹‹å<code>rm -f</code>åˆ é™¤æœ¬åœ°çš„å¤‡ä»½æ–‡ä»¶ï¼Œæœ€åè®¾ç½®rcloneåˆ é™¤å¤§äº7å¤©çš„å¤‡ä»½æ–‡ä»¶ã€‚è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥ç›´æ¥åœ¨Scalewayåˆ é™¤ï¼Œå‚è€ƒ<a href="https://www.notion.so/0f154999939e44109a5827e6c542fb53#59063f5382174e638fc529602d810d32">å¾ªç¯é”€æ¯å¤‡ä»½æ–‡ä»¶</a>ã€‚</p><p>åœ¨æˆ‘æ›´æ”¹åçš„è„šæœ¬ï¼Œæˆ‘é‡‡å–çš„æ–¹æ³•æ˜¯æ¯æ¬¡å…ˆåˆ é™¤ä¸Šä¸€æ¬¡çš„å¤‡ä»½æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ä¸Šä¼ ååˆ é™¤ï¼Œè¿™æ ·å¯ä»¥åœ¨æœ¬åœ°å’ŒScalewayéƒ½æœ‰ä¸€ä¸ªå¤‡ä»½ã€‚</p><p>Scalewayå’Œ<code>rclone</code>çš„è®¾ç½®å¯å‚è€ƒ<a href="https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/10/19/Mastodon-on-Docker.html#%E5%88%A9%E7%94%A8scaleway%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93">åˆ©ç”¨Scalewayå¤‡ä»½æ•°æ®åº“</a> ï¼Œ<a href="https://www.notion.so/0f154999939e44109a5827e6c542fb53">è®¾ç½®å®šæœŸå¼‚åœ°å¤‡ä»½é•¿æ¯›è±¡æ•°æ®åº“å’Œå…³é”®é…ç½®</a> ï¼Œ</p><p>æ³¨æ„ï¼Œå¤‡ä»½çš„<code>bucket</code>è¦å’Œåª’ä½“å­˜å‚¨çš„åˆ†å¼€ï¼Œå¹¶ä¸”è®¾ä¸º<code>private</code>ï¼ï¼</p><p>å¯ä»¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone ls scaleway:ä½ çš„bucketåç§°</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹bucketé‡Œçš„æ–‡ä»¶ï¼Œç¡®è®¤æ˜¯å¦æ­£å¸¸ä¸Šä¼ å’Œåˆ é™¤ã€‚</p><p>æœ€ç»ˆæˆ‘çš„å®Œæ•´è„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># Save this file at  /opt/mastodon-backup/backup.sh</span><br><span class="line"># Set a cronjob:  0 5 * * * root /bin/bash /opt/mastodon-backup/backup.sh &gt; /opt/mastodon-backup/logs/backup.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># Loading /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"># Set backup_folder and name</span><br><span class="line">now=$(date &quot;+%Y%m%d-%H%M%S&quot;)</span><br><span class="line">origin_folder=&quot;/home/mastodon/mastodon&quot;</span><br><span class="line">backup_folder=&quot;/opt/mastodon-backup/dbbackup&quot;</span><br><span class="line">target_bucket=&quot;scaleway:ä½ çš„bucketåç§°&quot;</span><br><span class="line"></span><br><span class="line"># Clean up old backup file</span><br><span class="line">rm -r $&#123;backup_folder&#125;/*</span><br><span class="line"></span><br><span class="line"># Generating a mastodon backup exclude cache</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; now starting export&quot;</span><br><span class="line">/usr/bin/zip -P å¯†ç  -rqx=$&#123;origin_folder&#125;/public/system/cache/* $&#123;backup_folder&#125;/backup_$&#123;now&#125;.zip $&#123;origin_folder&#125;</span><br><span class="line"></span><br><span class="line"># Copying important files</span><br><span class="line">cp -r /etc/nginx/sites-available/ $&#123;backup_folder&#125;</span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; local backup done!&quot;</span><br><span class="line"></span><br><span class="line"># upload to scaleway</span><br><span class="line">/usr/bin/rclone copy $&#123;backup_folder&#125;/ $&#123;target_bucket&#125; </span><br><span class="line">echo `date +&quot;%Y-%m-%d %H:%M:%S&quot;` &quot; ok all done&quot;</span><br><span class="line"></span><br><span class="line"># delete backup longer than 7d</span><br><span class="line">/usr/bin/rclone --min-age 7d  delete $&#123;target_bucket&#125; </span><br></pre></td></tr></table></figure><p>å•ç‹¬è¿è¡Œä¸€éå¯ä»¥æˆåŠŸåï¼Œå°±å¯ä»¥æŠŠ<code>crontab</code>ä¸­çš„<code>backup_local.sh</code>æ”¹ä¸º<code>backup.sh</code>å•¦ï¼è¿™æ ·ä½ å°±æœ‰äº†ä¸€ä¸ªï¼š</p><ul><li>æœ¬åœ°å’ŒscalewayåŒé‡å¤‡ä»½</li><li>æœ¬åœ°ä¿ç•™ä¸€å¤©ï¼Œscalewayä¿ç•™7å¤©</li><li>åŒ…å«nginxè®¾ç½®å’Œæ•´ä¸ªmastodonç›®å½•</li></ul><p>çš„å¤‡ä»½å•¦ï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;å†™åœ¨å‰é¢ï¼š&lt;/strong&gt;&lt;br&gt;æœ¬æ–‡å¤‡ä»½æ–¹æ³•æˆ‘è¿˜åœ¨éªŒè¯ä¸­ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼Œæœ€å¥½ä»¥é˜²ä¸‡ä¸€å¤šå¯¼å‡ºä¸€ä»½&lt;code&gt;backup.dump&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Whyï¼šä¸ºä»€ä¹ˆè¦å¤‡ä»½&quot;&gt;&lt;a href=&quot;#Whyï¼šä¸ºä»€ä¹ˆè¦å¤‡ä»½&quot; class=&quot;h</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="Mastodon" scheme="https://tech.konata.co/tags/Mastodon/"/>
    
    <category term="postgres" scheme="https://tech.konata.co/tags/postgres/"/>
    
    <category term="Scaleway" scheme="https://tech.konata.co/tags/Scaleway/"/>
    
  </entry>
  
  <entry>
    <title>Mastodon å»ºç«™ç¬”è®°</title>
    <link href="https://tech.konata.co/2022-02-10-build-a-mastodon/"/>
    <id>https://tech.konata.co/2022-02-10-build-a-mastodon/</id>
    <published>2022-02-09T20:38:33.000Z</published>
    <updated>2022-02-19T14:02:38.686Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>å‚è€ƒ<a href="https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/10/19/Mastodon-on-Docker.html">è“ç›’å­ç«™é•¿çš„æ•™ç¨‹</a> ï¼Œä¸€ç›´è¿›è¡Œåˆ°æŠŠ docker å’Œ docker-compose è£…å¥½ã€‚</p><p>Checklistï¼š</p><ul><li>ssh-keyè®¾ç½®å¹¶å…³é—­å¯†ç ç™»å½•</li><li>å¼€å¯é˜²ç«å¢™</li><li>åŸŸåæ˜ å°„åˆ°æœåŠ¡å™¨ip</li><li>å®‰è£…æˆåŠŸ docker å’Œ docker-compose</li></ul><h2 id="Postgres-database"><a href="#Postgres-database" class="headerlink" title="Postgres database"></a>Postgres database</h2><p><strong>Update 2022.2.19ï¼š</strong></p><p>è¿™ä¸€æ­¥æˆ‘å·²ç»æ‰¾åˆ°åŸå› äº†ï¼Œæ˜¯å› ä¸ºåœ¨åŸæ•™ç¨‹ä¸­ï¼Œå†™çš„æ˜¯ï¼š</p><blockquote><p>åˆšæ‰docker-compose.ymlæ–‡ä»¶ä¸­ï¼Œæ•°æ®åº“ï¼ˆdbï¼‰éƒ¨åˆ†çš„åœ°å€ä¸º.&#x2F;postgres:&#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;dataï¼Œå› æ­¤ä½ çš„æ•°æ®åº“ç»å¯¹åœ°å€ä¸º&#x2F;home&#x2F;mastodon&#x2F;mastodon&#x2F;postgresã€‚</p></blockquote><p>ç„¶åæˆ‘å‘ç°æˆ‘wgetæœ€æ–°çš„docker-composeé…ç½®ï¼Œè¿™è¾¹å·²ç»å˜æˆäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - ./postgres14:/var/lib/postgresql/data</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘å½“æ—¶æŒ‰ç…§æ•™ç¨‹è¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name postgres12 -v /home/mastodon/mastodon/postgres:/var/lib/postgresql/data -e   POSTGRES_PASSWORD=è®¾ç½®æ•°æ®åº“ç®¡ç†å‘˜å¯†ç  --rm -d postgres:12.5-alpine</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯åœ¨<code>./postgres</code>é‡Œæ“ä½œï¼Œä½†æˆ‘åº”è¯¥åœ¨<code>./postgres14</code>é‡Œæ“ä½œæ‰èƒ½çœŸçš„æŠŠæ•°æ®å†™è¿›dockerã€‚æ‰€ä»¥è¿™é‡Œåº”è¯¥æŠŠå‘½ä»¤æ”¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name postgres12 -v /home/mastodon/mastodon/postgres14:/var/lib/postgresql/data -e   POSTGRES_PASSWORD=è®¾ç½®æ•°æ®åº“ç®¡ç†å‘˜å¯†ç  --rm -d postgres:12.5-alpine</span><br></pre></td></tr></table></figure><p>æˆ–è€…æŠŠdocker-composeä¸­çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - ./postgres14:/var/lib/postgresql/data</span><br></pre></td></tr></table></figure><p>æ”¹å›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - ./postgres:/var/lib/postgresql/data</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ç›®çš„éƒ½æ˜¯è®©æˆ‘ä»¬èƒ½çœŸçš„å®é™…æ“ä½œåˆ°postgresçš„æ•°æ®å¹¶è®©dockerèƒ½è®¿é—®åˆ°ã€‚</p><p>è¿™é‡Œå› ä¸ºæˆ‘è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰çš„è·¯å¾„æ“ä½œï¼Œåæ¥ç›´æ¥è¿›å…¥<code>mastodon_db_1</code>æ‰çœŸæ­£å†™åˆ°äº†<code>./postgres14</code>é‡Œï¼Œæ‰€ä»¥æˆ‘çš„<code>./postgres</code>å®é™…ä¸Šæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œæˆ‘å°±æŠŠæ•´ä¸ªæ–‡ä»¶å¤¹åˆ æ‰äº†ã€‚</p><p><strong>åŸæ–‡ï¼š</strong></p><p>åœ¨è®¾ç½®mastodonçš„æ—¶å€™ï¼Œè¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose run --<span class="built_in">rm</span> web bundle <span class="built_in">exec</span> rake mastodon:setup</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨è¿™ä¸ªåœ°æ–¹å¡ä½äº†éå¸¸ä¹…ï¼Œåœ¨postgresé‚£é‡Œå°è¯•äº†å„ç§ç‰ˆæœ¬æ•™ç¨‹çš„æ’åˆ—ç»„åˆæœ€åçš„ç»“æœéƒ½æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Database connection could not be established with this configuration, try again.</span><br><span class="line">FATAL:  role <span class="string">&quot;mastodon&quot;</span> does not exist</span><br></pre></td></tr></table></figure><p>åæ¥æˆ‘è®¤çœŸçœ‹äº†ä¸€ä¸‹è¿™ä¸€æ­¥ï¼Œå®ƒçš„è¾“å‡ºæ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Starting mastodon_db_1    ... <span class="keyword">done</span></span><br><span class="line">Starting mastodon_redis_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹docker containerä¹Ÿæ˜¯è¿™ä¸¤ä¸ªdockeråœ¨è·‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker container list -a</span><br><span class="line">CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS                    PORTS     NAMES</span><br><span class="line">bd7debf13a49   redis:6-alpine         <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   31 minutes ago   Up 31 minutes (healthy)             mastodon_redis_1</span><br><span class="line">30c6e3b74c40   postgres:12.5-alpine   <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   31 minutes ago   Up 31 minutes (healthy)             mastodon_db_1</span><br></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘å°è¯•æŠŠæ•™ç¨‹ä¸­4. åˆå§‹åŒ–PostgreSQLçš„è¿™å¥è¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it postgres12 psql -U postgres</span><br></pre></td></tr></table></figure><p>æ”¹æˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mastodon_db_1 psql -U postgres</span><br></pre></td></tr></table></figure><p>ä¹‹åå†æ·»åŠ mastodonç”¨æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; CREATE USER mastodon WITH PASSWORD <span class="string">&#x27;your_password&#x27;</span> CREATEDB;</span><br><span class="line">&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´æ“ä½œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">exec</span> -it mastodon_db_1 psql -U postgres</span><br><span class="line">psql (12.5)</span><br><span class="line">Type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">postgres=<span class="comment"># CREATE USER mastodon WITH PASSWORD &#x27;your_password&#x27; CREATEDB;</span></span><br><span class="line">CREATE ROLE</span><br><span class="line">postgres=<span class="comment"># exit</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å†è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose run --<span class="built_in">rm</span> web bundle <span class="built_in">exec</span> rake mastodon:setup</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸‹åˆ—è¾“å‡ºå°±å¯ä»¥é€šè¿‡éªŒè¯äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Domain name: example.com</span><br><span class="line"></span><br><span class="line">Single user mode disables registrations and redirects the landing page to your public profile.</span><br><span class="line">Do you want to <span class="built_in">enable</span> single user mode? No</span><br><span class="line"></span><br><span class="line">Are you using Docker to run Mastodon? Yes</span><br><span class="line"></span><br><span class="line">PostgreSQL host: mastodon_db_1</span><br><span class="line">PostgreSQL port: 5432</span><br><span class="line">Name of PostgreSQL database: mastodon</span><br><span class="line">Name of PostgreSQL user: mastodon</span><br><span class="line">Password of PostgreSQL user: ï¼ˆè¿™é‡Œå†™ä¸Šé¢ä½ ç»™mastodonè®¾ç½®çš„your_passwordsï¼‰</span><br><span class="line">Database configuration works! ğŸ†</span><br><span class="line"></span><br><span class="line">Redis host: mastodon_redis_1</span><br><span class="line">Redis port: 6379</span><br><span class="line">Redis password: ï¼ˆè¿™é‡Œæ˜¯ç›´æ¥å›è½¦ï¼Œæ²¡æœ‰å¯†ç ï¼‰</span><br><span class="line">Redis configuration works! ğŸ†</span><br><span class="line"></span><br><span class="line">Do you want to store uploaded files on the cloud? No</span><br><span class="line"></span><br><span class="line">Do you want to send e-mails from localhost? No</span><br><span class="line">SMTP server: smtp.zoho.eu</span><br><span class="line">SMTP port: 587</span><br><span class="line">SMTP username: ä½ çš„zohoç®¡ç†å‘˜é‚®ç®±åœ°å€</span><br><span class="line">SMTP password: ä½ çš„zohoç®¡ç†å‘˜å¯†ç </span><br><span class="line">SMTP authentication: plain</span><br><span class="line">SMTP OpenSSL verify mode: none</span><br><span class="line">E-mail address to send e-mails <span class="string">&quot;from&quot;</span>: ä½ çš„zohoç®¡ç†å‘˜é‚®ç®±åœ°å€</span><br><span class="line">Send a <span class="built_in">test</span> e-mail with this configuration right now? no</span><br><span class="line"></span><br><span class="line">This configuration will be written to .env.production</span><br><span class="line">Save configuration? Yes</span><br><span class="line">Below is your configuration, save it to an .env.production file outside Docker:</span><br></pre></td></tr></table></figure><p>æŠŠæ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸€ç›´åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It is also saved within this container so you can proceed with this wizard.</span><br></pre></td></tr></table></figure><p>ä¸¤è¡Œç»¿å­—ä¸­é—´çš„æ‰€æœ‰å†…å®¹éƒ½å¤åˆ¶ä¸‹æ¥ã€‚</p><p>æ¥ä¸‹æ¥ä¾ç„¶æŒ‰ç…§è“ç›’å­æ•™ç¨‹èµ°ï¼Œä¸¤ä¸ªé—®é¢˜é€‰yesï¼Œè¾“å…¥ç®¡ç†å‘˜è´¦å·ã€‚</p><h2 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h2><p>è¿™è¾¹åˆå‡ºäº†é—®é¢˜ï¼ŒæŒ‰ç…§æ•™ç¨‹èµ°ä¸‹æ¥åœ¨è¿™ä¸€æ­¥æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl reload nginx</span><br><span class="line">Job <span class="keyword">for</span> nginx.service failed.</span><br><span class="line">See <span class="string">&quot;systemctl status nginx.service&quot;</span> and <span class="string">&quot;journalctl -xe&quot;</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nginx -t</span><br><span class="line">nginx: [emerg] no <span class="string">&quot;ssl_certificate&quot;</span> is defined <span class="keyword">for</span> the <span class="string">&quot;listen ... ssl&quot;</span> directive <span class="keyword">in</span> /etc/nginx/sites-enabled/example.com.conf:25</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> failed</span><br></pre></td></tr></table></figure><p>åŸæ¥æ˜¯è¯ä¹¦æ²¡æœ‰è®¾ç½®å¥½ã€‚è¿™è¾¹æˆ‘æŠŠsoft linkå…ˆå–æ¶ˆäº†ï¼ˆå¦åˆ™ä¼šæŠ¥é”™ï¼‰ï¼Œè¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> /etc/nginx/sites-enabled/example.com.conf</span><br><span class="line">sudo certbot certonly --nginx -d example.com</span><br><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/example.com.conf /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>ï¼ˆè¿™è¾¹ä¸€å®šè¦åŠ  <strong>certonly</strong> è¿™ä¸ªå‚æ•°ï¼æˆ‘å› ä¸ºè¿™ä¸€æ­¥debugäº†ä¸€æ•´å¤©ï¼‰</p><p>ç„¶åæŠŠexample.com.conf é‡Œè¿™ä¸¤è¡Œå–æ¶ˆæ³¨é‡Šï¼ˆ#åˆ æ‰ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Uncomment these lines once you acquire a certificate:</span><br><span class="line">ssl_certificate     /etc/letsencrypt/live/example.com/fullchain.pem;</span><br><span class="line">ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</span><br></pre></td></tr></table></figure><p>è®°å¾—ä¸Šé¢çš„example.comå®é™…ä¸Šåº”è¯¥æ˜¯ä½ çš„åŸŸåã€‚</p><p>è¦ç¡®ä¿ä½ çš„<code>nginx -t</code>æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæˆ‘é‡åˆ°äº†warningç»“æœæœ€åçœŸçš„æ˜¯é‚£ä¸ªwarningå¯¼è‡´çš„é”™è¯¯ï¼Œä¸è¦å¿½ç•¥warningï¼</p><p>æœ€åå¯ä»¥é€šè¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot renew --dry_run</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è¯ä¹¦çš„è‡ªåŠ¨æ›´æ–°æ˜¯å¦èµ·æ•ˆï¼Œ<code>--dry_run</code>å°±æ˜¯ä»…æ‰“å°ä¿¡æ¯ï¼Œä¸å®é™…æ‰§è¡Œã€‚</p><p>è¿™ä¸€æ­¥å¾ˆå¤šæ•™ç¨‹ä¼šæ•™ä½ è®¾ç½®å®šæœŸä»»åŠ¡æ¥æ›´æ–°ï¼Œä½†å®é™…ä¸Šcertbotæ˜¯ä¼šè‡ªåŠ¨æ›´æ–°çš„ï¼ˆå‚è€ƒ<a href="https://blog.csdn.net/AlistairEd/article/details/113804554">è¿™ç¯‡æ–‡ç« </a> ï¼‰ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/10/19/Mastodon-on-Docker.html">https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/10/19/Mastodon-on-Docker.html</a></p><p><a href="https://gist.github.com/TrillCyborg/84939cd4013ace9960031b803a0590c4">https://gist.github.com/TrillCyborg/84939cd4013ace9960031b803a0590c4</a></p><p><a href="https://peterbabic.dev/blog/running-mastodon-with-docker-compose/">https://peterbabic.dev/blog/running-mastodon-with-docker-compose/</a></p><p><a href="https://www.howtoforge.com/how-to-install-mastodon-social-network-with-docker-on-ubuntu-1804/">https://www.howtoforge.com/how-to-install-mastodon-social-network-with-docker-on-ubuntu-1804/</a></p><p><a href="https://www.alibabacloud.com/blog/how-to-install-mastodon-using-docker-on-alibaba-cloud-ecs_595049">https://www.alibabacloud.com/blog/how-to-install-mastodon-using-docker-on-alibaba-cloud-ecs_595049</a></p><p><a href="https://www.linode.com/docs/guides/install-mastodon-on-ubuntu-2004/">https://www.linode.com/docs/guides/install-mastodon-on-ubuntu-2004/</a></p><p><a href="https://www.notion.so/Mastodon-042a05ee29a048df8b2c1afd49e4c49b">https://www.notion.so/Mastodon-042a05ee29a048df8b2c1afd49e4c49b</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Prerequisites&quot;&gt;&lt;a href=&quot;#Prerequisites&quot; class=&quot;headerlink&quot; title=&quot;Prerequisites&quot;&gt;&lt;/a&gt;Prerequisites&lt;/h2&gt;&lt;p&gt;å‚è€ƒ&lt;a href=&quot;https://pullope</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="nginx" scheme="https://tech.konata.co/tags/nginx/"/>
    
    <category term="certbot" scheme="https://tech.konata.co/tags/certbot/"/>
    
    <category term="mastodon" scheme="https://tech.konata.co/tags/mastodon/"/>
    
  </entry>
  
  <entry>
    <title>Wordpress å»ºç«™ç¬”è®°</title>
    <link href="https://tech.konata.co/2022-02-09-blog-note/"/>
    <id>https://tech.konata.co/2022-02-09-blog-note/</id>
    <published>2022-02-08T19:05:05.000Z</published>
    <updated>2022-02-21T17:36:10.401Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒæ•™ç¨‹ï¼š <a href="https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-docker-compose">https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-docker-compose</a></p><h3 id="Step-1-è®¾ç½®åä»£"><a href="#Step-1-è®¾ç½®åä»£" class="headerlink" title="Step 1 è®¾ç½®åä»£"></a>Step 1 è®¾ç½®åä»£</h3><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯å¯¹nginxè¿›è¡Œè®¾ç½®ã€‚</p><p>åä»£æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦åä»£ï¼Ÿä¸€èˆ¬è€Œè¨€ä¾‹å¦‚VPNè¿™æ ·çš„æœåŠ¡å°±æ˜¯æ­£å‘ä»£ç†ï¼Œä»£ç†å®¢æˆ·ç«¯è®¿é—®å„ä¸ªç½‘ç«™ã€‚è€Œåå‘ä»£ç†æ˜¯æœåŠ¡å™¨çš„ä»£ç†ã€‚ </p><p><code>listen</code>ï¼šå‘Šè¯‰nginxè¦ç›‘å¬å“ªä¸ªç«¯å£ã€‚è¿™æ­¥æš‚æ—¶åªç”¨äº†80ç«¯å£ï¼Œä¹Ÿå°±æ˜¯HTTPç”¨çš„ã€‚ä¹‹åSSLä¸‹æ¥äº†ä»¥ååŠ ä¸Š443ï¼Œä¹Ÿå°±æ˜¯HTTPSç”¨çš„ã€‚</p><p><code>server_name</code>ï¼šåŸŸåï¼Œè¿™é‡Œä¼¼ä¹å…¶å®åªéœ€è¦å†™blog.konata.coå°±å¤Ÿäº†ï¼Ÿå‰ååªæ˜¯ä¼˜å…ˆçº§ï¼Ÿ</p><p><code>index</code>ï¼šç½‘é¡µçš„indexæ–‡ä»¶ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§æ’åº</p><p><code>root</code>ï¼šè¿™ä¸ªæ˜¯æ ¹ç›®å½•åœ°å€ï¼Œä¹‹åä¼šåœ¨dockerfileé‡Œmountåˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><h3 id="Step-2-è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#Step-2-è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="Step 2 è®¾ç½®ç¯å¢ƒå˜é‡"></a>Step 2 è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯æŠŠå¯†ç ç”¨æˆ·ååŠ åˆ°ç¯å¢ƒå˜é‡é‡Œï¼Œç„¶åç”±äºæ¶‰åŠæ•æ„Ÿä¿¡æ¯ï¼Œæ‰€ä»¥é¢å¤–æ·»åŠ äº†.gitignoreå’Œ.dockerignore</p><h3 id="Step-3-è®¾ç½®docker-compose"><a href="#Step-3-è®¾ç½®docker-compose" class="headerlink" title="Step 3 è®¾ç½®docker-compose"></a>Step 3 è®¾ç½®docker-compose</h3><p>Docker-composeå’Œdockerfileæ˜¯ä¸¤ä¸ªä¸œè¥¿ï¼Œå„è‡ªç”¨å¤„è§ï¼š</p><p><a href="https://www.runoob.com/docker/docker-dockerfile.html">https://www.runoob.com/docker/docker-dockerfile.html</a></p><p><a href="https://www.runoob.com/docker/docker-compose.html">https://www.runoob.com/docker/docker-compose.html</a></p><p>Docker-composeæ˜¯ç”¨æ¥é…ç½®å®¹å™¨å†…æœåŠ¡çš„ã€‚è¿™é‡Œä¾æ¬¡é…ç½®äº†dbï¼ˆæ•°æ®åº“ï¼‰ï¼Œwordpressï¼Œwebserverï¼ˆnginxåä»£ï¼‰å’Œcertbotï¼ˆhttpsè¯ä¹¦ï¼‰ã€‚</p><p>åœ¨servicesä¸­ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„imageæŒ‡å®šäº†æ˜¯ä»å“ªä¸ªé•œåƒå¯åŠ¨æœåŠ¡ã€‚è¿™é‡Œç”¨çš„éƒ½æ˜¯å…¬å¼€çš„ç°æˆçš„é•œåƒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¯åŠ¨ã€‚</p><p>è¿™ä¸€æ­¥wordpressç”¨çš„é•œåƒæ˜¯image: wordpress:5.1.1-fpm-alpineï¼Œç‰ˆæœ¬æ¯”è¾ƒæ—§ï¼Œå¯ä»¥æ›¿æ¢æˆ<a href="https://hub.docker.com/_/wordpress/">è¿™é‡Œ</a> æ›´æ–°çš„tagï¼Œå¦‚<code>5.9.0-fpm-alpine</code>ï¼Œä¹Ÿè®¸å°±å¯ä»¥è§£å†³phpç‰ˆæœ¬è¿‡è€çš„é—®é¢˜ï¼ˆå¾…ç¡®è®¤ï¼‰ã€‚</p><h3 id="Step-4-è·å–SSLè¯ä¹¦"><a href="#Step-4-è·å–SSLè¯ä¹¦" class="headerlink" title="Step 4 è·å–SSLè¯ä¹¦"></a>Step 4 è·å–SSLè¯ä¹¦</h3><p>è¦ç”¨httpsè€Œä¸æ˜¯httpï¼Œéœ€è¦è·å–SSLè¯ä¹¦ã€‚åœ¨ä¸Šä¸€æ­¥å·²ç»é…ç½®å¥½äº†certbotï¼Œè¿™ä¸€æ­¥é¦–å…ˆå¯åŠ¨docker-composeã€‚</p><p><code>docker-compose up</code> æ˜¯å¯åŠ¨ï¼ŒåŠ ä¸Š<code>-d</code>æ˜¯åœ¨åå°è¿è¡Œã€‚</p><p><code>docker-compose ps</code> å¯ä»¥æ£€æŸ¥æœåŠ¡è¿è¡Œæƒ…å†µã€‚</p><p><code>docker-compose exec webserver ls -la /etc/letsencrypt/live</code> è¿™å¥è¯æŒ‡çš„æ˜¯å¯åŠ¨webserverçš„dockerç„¶åæŸ¥çœ‹åŸŸåæ˜¯å¦è®¾ç½®æˆåŠŸã€‚ä»åå­—ä¸Šçœ‹ä¼¼ä¹ç”¨çš„æ˜¯Letâ€™s Encryptçš„æœåŠ¡ã€‚å¦‚æœè®¾ç½®æˆåŠŸï¼Œå°±å¯ä»¥è¿›å…¥<code>docker-compose.yml</code>æŠŠ<code>--staging</code>è¿™ä¸ªè°ƒè¯•ç”¨çš„å‚æ•°æ”¹æˆ<code>--force-renewal</code>ï¼Œé‡æ–°ç”³è¯·ä¸€ä¸ªæ­£å¼çš„è¯ä¹¦ã€‚</p><p><code>docker-compose up --force-recreate --no-deps certbot</code>  ä½¿æœ€æ–°çš„docker-compose.ymlç”Ÿæ•ˆã€‚</p><h3 id="Step-5-ä¿®æ”¹nginx"><a href="#Step-5-ä¿®æ”¹nginx" class="headerlink" title="Step 5 ä¿®æ”¹nginx"></a>Step 5 ä¿®æ”¹nginx</h3><p> å› ä¸ºå·²ç»ç”³è¯·åˆ°äº†SSLè¯ä¹¦ï¼Œç°åœ¨è¦è¿”å›ä¿®æ”¹<code>nginx</code>ã€‚</p><p>å…ˆæŠŠ<code>webserver</code>æœåŠ¡åœäº†ï¼Œç„¶åä¸‹è½½<code>certbot</code>çš„<code>nginx</code>é…ç½®æ–‡ä»¶<code>options-ssl-nginx.conf</code>ï¼Œåˆ é™¤æ—§çš„<code>nginx.conf</code>æ”¹æˆæ–°çš„<code>nginx.conf</code>ï¼Œå†ä¿®æ”¹<code>docker-compose.yml</code>é‡Œ<code>webserver</code>çš„é…ç½®ï¼ŒæŠŠ<code>443</code>ç«¯å£æ·»åŠ ä¸Šå»ã€‚</p><p><code>docker-compose up --force-recreate --no-deps webserver</code> ä½¿æœ€æ–°çš„docker-compose.ymlç”Ÿæ•ˆã€‚</p><h3 id="Step-6-å‰ç«¯å®‰è£…"><a href="#Step-6-å‰ç«¯å®‰è£…" class="headerlink" title="Step 6 å‰ç«¯å®‰è£…"></a>Step 6 å‰ç«¯å®‰è£…</h3><p> åˆ°è¿™æ­¥ä¸ºæ­¢ï¼Œ<code>nginx</code>åä»£ï¼ŒSSLè¯ä¹¦ï¼Œ<code>wordpress</code>ï¼Œå…¨éƒ¨éƒ½å®‰è£…å¥½å¹¶ä¸”åœ¨åå°è¿è¡Œäº†ã€‚è¿™æ—¶å€™è®¿é—®åŸŸåï¼Œå°±ä¼šå‡ºç°<code>wordpress</code>çš„å®‰è£…ç•Œé¢ã€‚å…¨ç¨‹ç½‘é¡µæ“ä½œï¼Œç®€å•æ˜“æ‡‚ã€‚</p><h3 id="Step-7-å®šæœŸæ›´æ–°è¯ä¹¦"><a href="#Step-7-å®šæœŸæ›´æ–°è¯ä¹¦" class="headerlink" title="Step 7 å®šæœŸæ›´æ–°è¯ä¹¦"></a>Step 7 å®šæœŸæ›´æ–°è¯ä¹¦</h3><p>å› ä¸ºè¯ä¹¦90å¤©å†…æœ‰æ•ˆï¼Œæ‰€ä»¥è¦å†™ä¸€ä¸ªè„šæœ¬æ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆå°äº90å¤©ï¼‰å°±é‡æ–°ç”³è¯·ä¸€æ¬¡è¯ä¹¦ã€‚è„šæœ¬å†…å®¹å¤§æ¦‚æ˜¯renew <code>certbot</code>å¹¶åˆ é™¤å¤šä½™é•œåƒï¼Œä¹‹åæŠŠè„šæœ¬çš„æƒé™è®¾ä¸ºå¯æ‰§è¡Œã€‚è°ƒç”¨<code>crontab</code>æ¥å®šæœŸè¿è¡Œè„šæœ¬ã€‚</p><p><code>*/5 * * * *</code>æ˜¯æ¯äº”åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œä¸ºäº†å¿«é€Ÿå‡ºæµ‹è¯•ç»“æœã€‚</p><p><code>\&gt;&gt; /var/log/cron.log 2&gt;&amp;1</code>æ˜¯æŠŠè¾“å‡ºå†™åˆ°logæ–‡ä»¶é‡Œï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚</p><p>ç¡®è®¤æ²¡æœ‰é—®é¢˜ä»¥åï¼Œæ”¹ä¸º<code>0 12 * * *</code>ï¼Œæ˜¯æ¯12å°æ—¶æ›´æ–°ä¸€æ¬¡ï¼Œéœ€è¦æ›´æ–°å¾—è¿™ä¹ˆé¢‘ç¹å—ï¼Ÿ</p><p>åŒæ—¶æŠŠè°ƒè¯•ç”¨çš„å‚æ•°<code>--dry-run</code>ä»è„šæœ¬é‡Œåˆ æ‰ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å‚è€ƒæ•™ç¨‹ï¼š &lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-with-docker-compose&quot;&gt;https://www.digitalocean.co</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="nginx" scheme="https://tech.konata.co/tags/nginx/"/>
    
    <category term="certbot" scheme="https://tech.konata.co/tags/certbot/"/>
    
    <category term="wordpress" scheme="https://tech.konata.co/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³ docker no space left on device</title>
    <link href="https://tech.konata.co/2021-09-16-docker-no-space/"/>
    <id>https://tech.konata.co/2021-09-16-docker-no-space/</id>
    <published>2021-09-16T07:14:57.000Z</published>
    <updated>2022-02-09T20:46:18.939Z</updated>
    
    <content type="html"><![CDATA[<p>æ“ä½œç³»ç»Ÿä¸º CentOS Linux release 7.2ï¼Œè¯•è¿‡ç½‘ä¸Šçš„ä¸€äº›æ–¹æ³•ä¾‹å¦‚è½¯é“¾æ¥ï¼Œå¢åŠ graphè·¯å¾„éƒ½æ²¡æœ‰ç”¨ï¼Œè‡ªå·±æ‘¸ç´¢æ‰¾åˆ°äº†é…ç½®è·¯å¾„çš„ä½ç½®ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><ol><li>ä½¿ç”¨<code>df -h</code> æŸ¥çœ‹ç£ç›˜çŠ¶å†µï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -h</span><br><span class="line">Filesystem                    Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vda1                      99G   91G  3.4G  97% /</span><br><span class="line">/dev/vdb1                     493G   62G  406G  14% /data</span><br><span class="line">overlay                        99G   91G  3.4G  97% /var/lib/docker/overlay2/xxx</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>/var/lib/docker/</code>æ”¾æ»¡äº†ï¼Œå¯ä»¥ç§»åˆ°<code>data</code>ç›®å½•ä¸‹ã€‚</p><p>åŒæ—¶å¯ä»¥å…ˆç¡®è®¤ä¸€ä¸‹ç›®å‰çš„ docker ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">...</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="2"><li>æ¸…ç†æ— ç”¨çš„å†…å®¹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker system prune</span><br></pre></td></tr></table></figure><p>å¯æ·»åŠ <code>-a</code>æ¸…é™¤å¾—æ›´å½»åº•ã€‚ä¹‹åæŸ¥çœ‹ç£ç›˜çŠ¶å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -h</span><br><span class="line">Filesystem                    Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vda1                      99G   83G   12G  88% /</span><br><span class="line">/dev/vdb1                     493G   62G  406G  14% /data</span><br><span class="line">overlay                        99G   83G   12G  88% /var/lib/docker/overlay2/xxx</span><br></pre></td></tr></table></figure><p>æœ‰æ‰€ç¼“è§£ï¼Œä½†12Gä¾ç„¶ä¸å¤Ÿç”¨ï¼Œéœ€è¦æ›´æ”¹ docker ç›®å½•åˆ° <code>/data</code>ä¸‹ã€‚</p><ol start="3"><li>åœæ­¢dockeræœåŠ¡</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop docker</span><br></pre></td></tr></table></figure><ol start="4"><li>åˆ›å»ºæ–°çš„dockerå·¥ä½œç›®å½•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /data/dockerlib</span><br></pre></td></tr></table></figure><ol start="5"><li>è¿ç§»&#x2F;var&#x2F;lib&#x2F;docker</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz /var/lib/docker /data/dockerlib</span><br></pre></td></tr></table></figure><ol start="6"><li>æ”¹åŠ¨é…ç½®æ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶ä¸­æ›´æ”¹</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;data-root&quot;</span>: <span class="string">&quot;/data/dockerlib/docker&quot;,</span></span><br></pre></td></tr></table></figure><ol start="7"><li>é‡å¯dockeræœåŠ¡</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line"> </span><br><span class="line">systemctl restart docker</span><br><span class="line"> </span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><ol start="8"><li>ç¡®è®¤æ˜¯å¦é…ç½®æˆåŠŸ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">...</span><br><span class="line">Docker Root Dir: /data/dockerlib/docker</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="9"><li>ç¡®è®¤ docker å·²ç»æˆåŠŸè½¬ç§»</li></ol><p>ä¿®æ”¹åŸ docker è·¯å¾„åï¼Œå†è¿›è¡Œä¸€äº›æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mv</span> /var/lib/docker /var/lib/docker_temp</span><br><span class="line">$ docker image list</span><br><span class="line">$ docker container list</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€æ­¥æˆ‘å‘ç°ä¹‹å‰çš„ container è¿›å»ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯é‡å¯åå¯ä»¥é‡æ–°è¿›å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop xxx</span><br><span class="line">$ docker start xxx</span><br><span class="line">$ docker <span class="built_in">exec</span> -it xxx /bin/bash</span><br></pre></td></tr></table></figure><p>ç¡®è®¤æ— è¯¯åå¯ä»¥åˆ é™¤ï¼Œä¸ºäº†é˜²æ­¢å‡ºé”™å¯ä»¥ç”¨ä¸€é˜µå­å†åˆ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">rm</span> -rf /var/lib/docker_temp</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ“ä½œç³»ç»Ÿä¸º CentOS Linux release 7.2ï¼Œè¯•è¿‡ç½‘ä¸Šçš„ä¸€äº›æ–¹æ³•ä¾‹å¦‚è½¯é“¾æ¥ï¼Œå¢åŠ graphè·¯å¾„éƒ½æ²¡æœ‰ç”¨ï¼Œè‡ªå·±æ‘¸ç´¢æ‰¾åˆ°äº†é…ç½®è·¯å¾„çš„ä½ç½®ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;df -h&lt;/code&gt; æŸ¥çœ‹ç£ç›˜çŠ¶å†µï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;fi</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="docker" scheme="https://tech.konata.co/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Hexo + GitHub Page è‡ªå»ºåšå®¢</title>
    <link href="https://tech.konata.co/2021-08-08-2021-08-08-build-blog-by-hexo/"/>
    <id>https://tech.konata.co/2021-08-08-2021-08-08-build-blog-by-hexo/</id>
    <published>2021-08-07T20:14:38.000Z</published>
    <updated>2022-02-08T19:04:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ›å»ºé¡µé¢"><a href="#åˆ›å»ºé¡µé¢" class="headerlink" title="åˆ›å»ºé¡µé¢"></a>åˆ›å»ºé¡µé¢</h1><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://zhuanlan.zhihu.com/p/70240127">https://zhuanlan.zhihu.com/p/70240127</a></p><p>ä½¿ç”¨Hexoè‡ªå»ºåšå®¢ï¼ŒHexoä¼šè‡ªåŠ¨ç”Ÿæˆé™æ€é¡µé¢å¹¶éƒ¨ç½²åˆ°GitHub repoä¸Šï¼Œä¸éœ€è¦ç›´æ¥git pushã€‚è€Œåœ¨GitHub repoé‡Œä¹Ÿåªä¼šæœ‰publicç›®å½•ä¸‹çš„å†…å®¹ã€‚ä¸æ­¤åŒæ—¶publicæ–‡ä»¶å¤¹åœ¨hexoçš„ç›®å½•ä¸‹æ˜¯åœ¨.gitignoreé‡Œçš„ï¼Œæ‰€ä»¥ä¸è¦ç›´æ¥pushæ•´ä¸ªç›®å½•ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç½‘é¡µ404ã€‚</p><p>å…³äºç½‘ç«™ä¿¡æ¯çš„ä¿®æ”¹åœ¨<code>_config.yml</code>è¿›è¡Œï¼Œä¾‹å¦‚ä¿®æ”¹æ ‡é¢˜åœ¨Siteä¸‹ã€‚</p><h2 id="ä¿®æ”¹åŸŸå"><a href="#ä¿®æ”¹åŸŸå" class="headerlink" title="ä¿®æ”¹åŸŸå"></a>ä¿®æ”¹åŸŸå</h2><p>ä¸»è¦æ­¥éª¤ä¸Šé¢çš„èµ„æ–™å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œä½†å…³äºè¿™æ®µ</p><blockquote><p>æ³¨ï¼šå¦‚æœä½ ç”¨äº† hexo clean å‘½ä»¤åˆ é™¤æœ¬åœ°é™æ€èµ„æºï¼ŒCNAMEæ–‡ä»¶ä¹Ÿä¼šè¢«åˆ æ‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆçš„publicæ–‡ä»¶å¤¹ä¸­ç›´æ¥åˆ›å»ºå¥½ï¼Œå†ä¸Šä¼ ã€‚</p></blockquote><p>ä¹Ÿè®¸æ˜¯typoï¼Œåº”è¯¥æŠŠCNAMEæ–‡ä»¶æ”¾åœ¨sourceé‡Œï¼Œæ‰ä¸ä¼šè¢«åˆ ã€‚</p><h1 id="å®‰è£…ä¸»é¢˜"><a href="#å®‰è£…ä¸»é¢˜" class="headerlink" title="å®‰è£…ä¸»é¢˜"></a>å®‰è£…ä¸»é¢˜</h1><p>æœ¬ç«™é‡‡ç”¨nextä¸»é¢˜ï¼š<a href="https://github.com/next-theme/hexo-theme-next">https://github.com/next-theme/hexo-theme-next</a></p><p>å› ä¸ºhexoæ˜¯5.0+ç‰ˆæœ¬ï¼Œæ‰€ä»¥å®‰è£…ä¸»é¢˜åªéœ€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd hexo-site</span><br><span class="line">$ npm install hexo-theme-next</span><br></pre></td></tr></table></figure><p>å†æŠŠ_config.ymlçš„themeæ”¹æˆnextã€‚ä½†è¿™ç§å®‰è£…æ–¹æ³•æ¯”è¾ƒæ–°ï¼Œnextçš„ä¸­æ–‡æ–‡æ¡£æ²¡æœ‰æ›´æ–°ï¼Œéœ€è¦å‚è€ƒè‹±æ–‡æ–‡æ¡£è¿›è¡Œå®šåˆ¶ï¼š<a href="https://theme-next.js.org/docs/getting-started/configuration.html">https://theme-next.js.org/docs/getting-started/configuration.html</a> ã€‚</p><p>ä»¥æ”¹schemeä¸ºä¾‹ï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢çš„æ•™ç¨‹èµ°ï¼Œé‚£å°±æ˜¯npmå®‰è£…çš„ï¼Œè¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp node_modules/hexo-theme-next/_config.yml _config.next.yml</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹Schemesçš„éƒ¨åˆ†å³å¯ã€‚</p><h1 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate # ç”Ÿæˆæœ¬åœ°é™æ€æ–‡ä»¶</span><br><span class="line">$ hexo deploy   # éƒ¨ç½²</span><br><span class="line">$ hexo clean   </span><br><span class="line">$ hexo g &amp; hexo d </span><br><span class="line">$ hexo new post &#x27;title&#x27;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åˆ›å»ºé¡µé¢&quot;&gt;&lt;a href=&quot;#åˆ›å»ºé¡µé¢&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºé¡µé¢&quot;&gt;&lt;/a&gt;åˆ›å»ºé¡µé¢&lt;/h1&gt;&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;a href=&quot;https://zhuanlan.zhihu.com/p/70240127&quot;&gt;https://z</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="GitHub" scheme="https://tech.konata.co/tags/GitHub/"/>
    
    <category term="Hexo" scheme="https://tech.konata.co/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>COMA ç¯å¢ƒé…ç½®è®°å½•</title>
    <link href="https://tech.konata.co/2021-07-23-COMA/"/>
    <id>https://tech.konata.co/2021-07-23-COMA/</id>
    <published>2021-07-22T16:05:35.000Z</published>
    <updated>2022-02-09T20:46:25.615Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/anuragranj/coma">https://github.com/anuragranj/coma</a></p><h2 id="Tensorflow-1-3"><a href="#Tensorflow-1-3" class="headerlink" title="Tensorflow 1.3"></a>Tensorflow 1.3</h2><p>è¿™ä¸€æ­¥ç”±äºtensorflow1çš„ç¯å¢ƒéå¸¸éš¾é…ç½®ï¼Œä½¿ç”¨ç°æˆdockerï¼Œç‰ˆæœ¬å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><p><a href="https://blog.csdn.net/qq_41936559/article/details/104226333">https://blog.csdn.net/qq_41936559/article/details/104226333</a></p><h2 id="opendrå®‰è£…"><a href="#opendrå®‰è£…" class="headerlink" title="opendrå®‰è£…"></a>opendrå®‰è£…</h2><p>opendrå®‰è£…å¯¹python3çš„æ”¯æŒæ¯”è¾ƒéº»çƒ¦ï¼Œå‚è€ƒï¼š</p><p><a href="https://www.codenong.com/cs110955392/">https://www.codenong.com/cs110955392/</a></p><h2 id="MPI-IS-x2F-meshé…ç½®"><a href="#MPI-IS-x2F-meshé…ç½®" class="headerlink" title="MPI-IS &#x2F; meshé…ç½®"></a>MPI-IS &#x2F; meshé…ç½®</h2><p><a href="https://github.com/MPI-IS/mesh">https://github.com/MPI-IS/mesh</a></p><p>ç»å¸¸è¦ç”¨åˆ°çš„meshæ¸²æŸ“å·¥å…·</p><p>é…ç½®è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install boost-devel</span><br><span class="line">BOOST_INCLUDE_DIRS=/usr/include/boost make all</span><br><span class="line">make tests</span><br></pre></td></tr></table></figure><p>é‡åˆ°æŠ¥é”™ï¼š<br>ImportError: No module named psbody.mesh.mesh<br>ä½†æ˜¯åœ¨python3ä¸‹importæ˜¯å¯ä»¥çš„ï¼Œåæ¥å‘ç°æ˜¯åœ¨make testsæ—¶é»˜è®¤æ˜¯pythonï¼Œè€Œåœ¨dockerç¯å¢ƒä¸‹è¦æ”¹æˆpython3ï¼Œæµ‹è¯•é€šè¿‡ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/anuragranj/coma&quot;&gt;https://github.com/anuragranj/coma&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Tensorflow-1-3&quot;&gt;&lt;a href=&quot;#Tensorflow-1-3&quot;</summary>
      
    
    
    
    <category term="Project" scheme="https://tech.konata.co/categories/Project/"/>
    
    
    <category term="COMA" scheme="https://tech.konata.co/tags/COMA/"/>
    
    <category term="opendr" scheme="https://tech.konata.co/tags/opendr/"/>
    
    <category term="Tensorflow" scheme="https://tech.konata.co/tags/Tensorflow/"/>
    
    <category term="MPI-IS" scheme="https://tech.konata.co/tags/MPI-IS/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨Macä¸Šæ“ä½œæ–‡ä»¶</title>
    <link href="https://tech.konata.co/2021-06-11-mac/"/>
    <id>https://tech.konata.co/2021-06-11-mac/</id>
    <published>2021-06-10T16:04:59.000Z</published>
    <updated>2022-02-09T20:46:30.118Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…homebrew"><a href="#å®‰è£…homebrew" class="headerlink" title="å®‰è£…homebrew"></a>å®‰è£…homebrew</h2><p><a href="https://www.jianshu.com/p/627b2d462151">https://www.jianshu.com/p/627b2d462151</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…ffmepg"><a href="#å®‰è£…ffmepg" class="headerlink" title="å®‰è£…ffmepg"></a>å®‰è£…ffmepg</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…rename"><a href="#å®‰è£…rename" class="headerlink" title="å®‰è£…rename"></a>å®‰è£…rename</h2><p><a href="https://commandnotfound.cn/linux/1/461/rename-%E5%91%BD%E4%BB%A4">https://commandnotfound.cn/linux/1/461/rename-å‘½ä»¤</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install rename</span><br></pre></td></tr></table></figure><h2 id="æ‰¹é‡æ”¹å"><a href="#æ‰¹é‡æ”¹å" class="headerlink" title="æ‰¹é‡æ”¹å"></a>æ‰¹é‡æ”¹å</h2><p><a href="https://zhuanlan.zhihu.com/p/90829056">https://zhuanlan.zhihu.com/p/90829056</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename &#x27;s/.mp41/.mp4/&#x27; *</span><br></pre></td></tr></table></figure><p>åæ¥å‘ç°å¯ä»¥ç›´æ¥å¤šé€‰å³é”®æ‰¹é‡æ”¹åã€‚</p><h2 id="çƒ­æ’æ‹”ä¿®å¤"><a href="#çƒ­æ’æ‹”ä¿®å¤" class="headerlink" title="çƒ­æ’æ‹”ä¿®å¤"></a>çƒ­æ’æ‹”ä¿®å¤</h2><p><a href="https://www.zhihu.com/question/308406915">https://www.zhihu.com/question/308406915</a><br>æ‰“å¼€ç£ç›˜å·¥å…·<br>æ‰“å¼€terminal</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">diskutil list</span><br><span class="line">ps aux | grep fsck</span><br><span class="line">sudo pkill -f fsck</span><br></pre></td></tr></table></figure><p>ç‚¹æ€¥æ•‘ï¼Œéœ€è¦ç­‰å¾ˆä¹…å¾ˆä¹…</p><h2 id="å‹ç¼©è§£å‹åˆ†å·"><a href="#å‹ç¼©è§£å‹åˆ†å·" class="headerlink" title="å‹ç¼©è§£å‹åˆ†å·"></a>å‹ç¼©è§£å‹åˆ†å·</h2><p>å‹ç¼©ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip test.zip test.doc </span><br></pre></td></tr></table></figure><p>åˆ†å·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -s 50m test.zip --out ziptest </span><br></pre></td></tr></table></figure><p>åˆå·ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ziptest.z* &gt; test.zip </span><br></pre></td></tr></table></figure><p>è§£å‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip test.zip</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å®‰è£…homebrew&quot;&gt;&lt;a href=&quot;#å®‰è£…homebrew&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…homebrew&quot;&gt;&lt;/a&gt;å®‰è£…homebrew&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/627</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="mac" scheme="https://tech.konata.co/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>å¤§å‹vscodeçœŸé¦™ç°åœº</title>
    <link href="https://tech.konata.co/2020-01-16-vscode/"/>
    <id>https://tech.konata.co/2020-01-16-vscode/</id>
    <published>2020-01-15T16:03:29.000Z</published>
    <updated>2022-02-09T20:46:34.083Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>æ˜¨å¤©æœ‹å‹æ¨èäº†vscodeä»¥åä»Šå¤©è¯•äº†ä¸€ä¸‹çœŸçš„æ˜¯ä¸€è§é’Ÿæƒ…ï¼Œä¹‹å‰å­¦c++çš„æ—¶å€™å°±å¾ˆå–œæ¬¢ç”¨vsï¼Œç°åœ¨ç”¨pythonè€Œä¸”åˆæ˜¯åœ¨æœåŠ¡å™¨ä¸Šè·‘ï¼Œä¸€ç›´è§‰å¾—sublimeè°ƒè¯•éå¸¸ä¸æ–¹ä¾¿ã€‚vscodeå¯¹äºä»¥å‰ç”¨ä¹ æƒ¯vsçš„äººä¸è¦å¤ªèˆ’æœï¼Œè€Œä¸”å¯¹jupyter notebookçš„æ”¯æŒæ„å¤–åœ°å¥½ï¼Œå¯ä»¥è¯´æ˜¯ç»¼åˆäº†å¥½å‡ ä¸ªæˆ‘éå¸¸çˆ±ç”¨çš„IDEçš„ä¼˜ç‚¹äº†ï¼</p><h1 id="åœ¨vscodeä¸­ä½¿ç”¨python"><a href="#åœ¨vscodeä¸­ä½¿ç”¨python" class="headerlink" title="åœ¨vscodeä¸­ä½¿ç”¨python"></a>åœ¨vscodeä¸­ä½¿ç”¨python</h1><p>è¿™ä¸ªç‰¹åˆ«ç®€å•ï¼Œä¸€ä¸ªå®˜æ–¹çš„æ•™ç¨‹å³å¯æå®šï¼š<a href="https://code.visualstudio.com/docs/python/python-tutorial">python-tutorial</a></p><p>å‡ ä¸ªæ³¨æ„çš„ç‚¹ï¼š</p><ul><li>è®¾ç½®è¯­è¨€</li></ul><p>æŒ‰F1ç„¶åæœç´¢â€œconfigure display languageâ€ï¼Œå°±å¯ä»¥é€‰æ‹©å’Œå®‰è£…è¯­è¨€</p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-c2ba80430dd7d00e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-66c6ebcbafa80b66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><ul><li>åˆ‡æ¢python ç¯å¢ƒ</li></ul><p>å·¦ä¸‹è§’è¿™é‡Œå¯ä»¥åˆ‡æ¢ç‰ˆæœ¬ï¼Œéå¸¸æ–¹ä¾¿</p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-36a9ffb7f4d5250f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><ul><li>å®‰è£…åŒ…</li></ul><p>æ ¹æ®tutorialæç¤ºï¼Œæœ€å¥½æ˜¯åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">py -3 -m venv .venv</span><br><span class="line">Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process</span><br><span class="line">.venv\scripts\activate</span><br><span class="line">python -m pip install matplotlib</span><br></pre></td></tr></table></figure><h1 id="ç”¨vscodeè¿œç¨‹å·¥ä½œ"><a href="#ç”¨vscodeè¿œç¨‹å·¥ä½œ" class="headerlink" title="ç”¨vscodeè¿œç¨‹å·¥ä½œ"></a>ç”¨vscodeè¿œç¨‹å·¥ä½œ</h1><p>è¿™ä¹Ÿæ˜¯æˆ‘æœ€å…³å¿ƒçš„é—®é¢˜ï¼Œæ¯•ç«Ÿæˆ‘çš„ä»£ç å‡ ä¹éƒ½æ˜¯åœ¨æœåŠ¡å™¨ä¸Šè·‘çš„ã€‚</p><p>é¦–å…ˆæ˜¯å®˜æ–¹æ•™ç¨‹ï¼š<a href="https://code.visualstudio.com/docs/remote/remote-overview">remote-overview</a>ï¼Œor more specificallyï¼š<a href="https://code.visualstudio.com/docs/remote/ssh">Remote Development using SSH</a></p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-a48b1a7d8bf81ef5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><p>ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œåœ¨vscodeä¸Šç”¨SSHè¿œç¨‹å·¥ä½œçš„å¤§è‡´åŸç†å°±æ˜¯ï¼Œæœ¬åœ°vscodeåªæä¾›UIï¼Œæ‰€æœ‰çš„å·¥ä½œåŒºå’Œä»£ç ä¹‹ç±»çš„å…¨æ˜¯åœ¨è¿œç¨‹è¿›è¡Œçš„ã€‚ä½†ä½ ç”¨èµ·æ¥çš„ä½“éªŒå°±åƒæ˜¯åœ¨æœ¬åœ°è°ƒä»£ç ä¸€æ ·ã€‚</p><p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œpythonæ’ä»¶è¦åœ¨è¿œç¨‹é‡æ–°å®‰è£…ä¸€æ¬¡ã€‚</p><h2 id="ä¸‹è½½remote-development"><a href="#ä¸‹è½½remote-development" class="headerlink" title="ä¸‹è½½remote development"></a>ä¸‹è½½remote development</h2><p>é¦–å…ˆåœ¨extensionså•†åº—æœç´¢â€œremote developmentâ€</p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-1b57d11b1f23682d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><h2 id="è¿æ¥remote-machine"><a href="#è¿æ¥remote-machine" class="headerlink" title="è¿æ¥remote machine"></a>è¿æ¥remote machine</h2><p>F1, Remote-SSH: Connect to Hostâ€¦ </p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-2435fc80c6943f5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><p>è¿™è¾¹æˆ‘é€‰æ‹©çš„æ˜¯add SSHç„¶åè¾“å…¥<code>username@hostname </code>ï¼Œä¹‹åå¼¹å‡ºæ¥çš„çª—å£ä¸Šæ–¹ä¼šæç¤ºæ˜¯å¦ç»§ç»­å’Œè¾“å…¥å¯†ç ï¼Œè¾“å…¥å¯†ç ä¹‹åå°±ä¼šè¿ä¸Šç„¶åå°±å¯ä»¥æ‰“å¼€æ–‡ä»¶å¤¹ã€‚</p><h2 id="å…å¯†ç™»å½•"><a href="#å…å¯†ç™»å½•" class="headerlink" title="å…å¯†ç™»å½•"></a>å…å¯†ç™»å½•</h2><p>è¿™ä¸ªæœ‰ç‚¹å¤æ‚ï¼Œå•ç‹¬è®²ä¸€ä¸‹ï¼Œå®˜ç½‘è§ï¼š<a href="https://code.visualstudio.com/docs/remote/troubleshooting#_quick-start-ssh-key">Quick start: SSH key</a>ï¼ŒåŒæ—¶å‚è€ƒäº†è¿™ç¯‡æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/89662757">ä½¿ç”¨vscodeè¿›è¡Œè¿œç¨‹ç‚¼ä¸¹</a>ã€‚</p><ol><li>åœ¨localæ‰“å¼€cmdï¼Œè¾“å…¥ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096</span><br></pre></td></tr></table></figure><p>ä¸­é€”æç¤ºè¾“å…¥æ–‡ä»¶è·¯å¾„å’Œå¯†ç ï¼Œéƒ½ç›´æ¥å›è½¦ã€‚</p><ol start="2"><li>ä¸Šä¼ å…¬é’¥</li></ol><p>è¿™è¾¹æˆ‘æ˜¯ç›´æ¥åœ¨æœåŠ¡å™¨æ–°å»ºäº†&#x2F;.ssh&#x2F;authorized_keysç„¶åæ‰‹åŠ¨æŠŠid_rsa.pubé‡Œçš„å†…å®¹å¤åˆ¶è¿›å»ã€‚</p><p>æ¥ä¸‹æ¥å†è¿æ¥å°±ä¸éœ€è¦è¾“å…¥å¯†ç äº†ã€‚</p><h2 id="åœ¨è¿œç¨‹ä¸­è°ƒè¯•"><a href="#åœ¨è¿œç¨‹ä¸­è°ƒè¯•" class="headerlink" title="åœ¨è¿œç¨‹ä¸­è°ƒè¯•"></a>åœ¨è¿œç¨‹ä¸­è°ƒè¯•</h2><p>é¦–å…ˆå°±æ˜¯æŠŠpythonæ’ä»¶å†å®‰è£…ä¸€æ¬¡ï¼Œç„¶åé‡æ–°è¿æ¥ï¼Œè¿™æ—¶å€™ä¼šé‡æ–°ä¹Ÿå®‰è£…ä¸€ä¸‹pylintã€‚</p><h1 id="åœ¨vscodeé‡Œç”¨jupyter-notebook"><a href="#åœ¨vscodeé‡Œç”¨jupyter-notebook" class="headerlink" title="åœ¨vscodeé‡Œç”¨jupyter notebook"></a>åœ¨vscodeé‡Œç”¨jupyter notebook</h1><p>è¿™ä¸ªæˆ‘ä¹‹å‰æƒ³å¤æ‚äº†ï¼Œå…¶å®ç›´æ¥æ–°å»ºä¸€ä¸ª.ipynbæ–‡ä»¶ï¼Œæ‰“å¼€å¹¶ä¸”è¿è¡Œï¼Œå°±ä¼šæç¤ºä½ æ²¡æœ‰è£…ï¼Œç„¶åä½ é€‰æ‹©ä¸€ä¸‹å®‰è£…æ–¹å¼conda&#x2F;pipå°±å¯ä»¥è£…å¥½äº†ã€‚</p><h2 id="è¿æ¥æœ¬åœ°çš„jupyter-notebook"><a href="#è¿æ¥æœ¬åœ°çš„jupyter-notebook" class="headerlink" title="è¿æ¥æœ¬åœ°çš„jupyter notebook"></a>è¿æ¥æœ¬åœ°çš„jupyter notebook</h2><p>ç”¨ä¸ä¸Šï¼Œç†è®ºä¸ŠåŒä¸‹</p><h2 id="è¿æ¥æœåŠ¡å™¨ä¸Šçš„jupyter-notebook"><a href="#è¿æ¥æœåŠ¡å™¨ä¸Šçš„jupyter-notebook" class="headerlink" title="è¿æ¥æœåŠ¡å™¨ä¸Šçš„jupyter notebook"></a>è¿æ¥æœåŠ¡å™¨ä¸Šçš„jupyter notebook</h2><p>æ„å¤–ä¹Ÿå¾ˆå®¹æ˜“ï¼Œåœ¨æƒ³è¦çš„ç›®å½•ä¸Š<code>jupyter notebook</code>ï¼Œå‡ºæ¥çš„é“¾æ¥ç‚¹è¿›å»å°±å¯ä»¥æ‰“å¼€äº†<br>ï¼ˆä¹‹å‰çš„å‘æ˜¯ç”¨<code>jupyter notebook list</code>ï¼Œç»“æœå‡ºæ¥çš„ç›®å½•æ˜¯home&#x2F;yournameï¼‰</p><hr><p>2020å¹´6æœˆ12æ—¥æ›´æ–°<br>ç”¨ä¸Šè¿°æ–¹æ³•åšæ–­è¿å°±æ‰“ä¸å¼€äº†ï¼Œéœ€è¦ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --ip=0.0.0.0 --port=xxxx</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<a href="http://gpu-server-2:xxxx/?token=xxxxé‡ŒæŠŠgpu-server-2æ¢æˆæœåŠ¡å™¨ipå°±å¯ä»¥äº†">http://gpu-server-2:xxxx/?token=xxxxé‡ŒæŠŠgpu-server-2æ¢æˆæœåŠ¡å™¨ipå°±å¯ä»¥äº†</a></p><h1 id="æ–­ç‚¹è°ƒè¯•æ˜¯è®¾ç½®å‚æ•°"><a href="#æ–­ç‚¹è°ƒè¯•æ˜¯è®¾ç½®å‚æ•°" class="headerlink" title="æ–­ç‚¹è°ƒè¯•æ˜¯è®¾ç½®å‚æ•°"></a>æ–­ç‚¹è°ƒè¯•æ˜¯è®¾ç½®å‚æ•°</h1><p>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<br><a href="https://blog.csdn.net/u012332816/article/details/80801106">https://blog.csdn.net/u012332816/article/details/80801106</a></p><p>like thisï¼š</p><pre><code>        &quot;args&quot;: [&quot;--config&quot;,&quot;../config_zach.yaml&quot;,            &quot;--path_config&quot;,&quot;../path_config_zach.yaml&quot;]</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;p&gt;æ˜¨å¤©æœ‹å‹æ¨èäº†vscodeä»¥åä»Šå¤©è¯•äº†ä¸€ä¸‹çœŸçš„æ˜¯ä¸€è§é’Ÿæƒ…ï¼Œä¹‹å‰å­¦c++çš„æ—¶å€™å°±å¾ˆå–œæ¬¢ç”¨vsï¼Œç°åœ¨ç”¨pythonè€Œä¸”åˆæ˜¯åœ¨æœåŠ¡å™¨ä¸Šè·‘ï¼Œä¸€ç›´è§‰å¾—sublimeè°ƒè¯•éå¸¸ä¸æ–¹ä¾¿ã€‚vscod</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="python" scheme="https://tech.konata.co/tags/python/"/>
    
    <category term="vscode" scheme="https://tech.konata.co/tags/vscode/"/>
    
    <category term="JupyterNotebook" scheme="https://tech.konata.co/tags/JupyterNotebook/"/>
    
  </entry>
  
  <entry>
    <title>ffmpegæ“ä½œé€ŸæŸ¥</title>
    <link href="https://tech.konata.co/2019-11-28-ffmpeg/"/>
    <id>https://tech.konata.co/2019-11-28-ffmpeg/</id>
    <published>2019-11-28T15:59:36.000Z</published>
    <updated>2022-02-09T20:46:37.513Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="åˆ‡å‰²éŸ³é¢‘"><a href="#åˆ‡å‰²éŸ³é¢‘" class="headerlink" title="åˆ‡å‰²éŸ³é¢‘"></a>åˆ‡å‰²éŸ³é¢‘</h2><p>ffmpeg -i zhaoliying.mp3 -vn -acodec copy -ss 00:00:00 -t 00:00:10 zhaoliying_10s.mp3</p><h2 id="åˆ‡å‰²è§†é¢‘"><a href="#åˆ‡å‰²è§†é¢‘" class="headerlink" title="åˆ‡å‰²è§†é¢‘"></a>åˆ‡å‰²è§†é¢‘</h2><p>ffmpeg -i target_video.mp4 -vcodec copy -acodec copy -ss 00:00:00 -t 00:00:05 target_video_5s.mp4</p><h2 id="åŠ logo"><a href="#åŠ logo" class="headerlink" title="åŠ logo"></a>åŠ logo</h2><p><a href="https://www.jianshu.com/p/a069df10a5fb">ç”¨ffmpegç»™è§†é¢‘æ‰¹é‡åŠ æ°´å°</a></p><h2 id="æå–éŸ³é¢‘"><a href="#æå–éŸ³é¢‘" class="headerlink" title="æå–éŸ³é¢‘"></a>æå–éŸ³é¢‘</h2><p>ffmpeg -i target_video_0829_1.mp4 -f mp3 -vn target_video_0829_1.mp3</p><h2 id="æ”¹fps"><a href="#æ”¹fps" class="headerlink" title="æ”¹fps"></a>æ”¹fps</h2><p>ffmpeg -i â€œtarget_video_0829_1.mp4â€ -r 29.97 -b:v 10M â€œtarget_video_0829_1_fps2997.mp4â€</p><h2 id="æ‹¼æ¥è§†é¢‘"><a href="#æ‹¼æ¥è§†é¢‘" class="headerlink" title="æ‹¼æ¥è§†é¢‘"></a>æ‹¼æ¥è§†é¢‘</h2><p>ffmpeg -i input1.mp4 -i input2.mp4 -filter_complex hstack output.mp4</p><h2 id="å›¾ç‰‡è½¬è§†é¢‘"><a href="#å›¾ç‰‡è½¬è§†é¢‘" class="headerlink" title="å›¾ç‰‡è½¬è§†é¢‘"></a>å›¾ç‰‡è½¬è§†é¢‘</h2><p>ffmpeg -f image2 -i %d.png  -vcodec libx264 -r 29.97 -b:v 10M  tt.mp4</p><h2 id="æ—‹è½¬è§†é¢‘"><a href="#æ—‹è½¬è§†é¢‘" class="headerlink" title="æ—‹è½¬è§†é¢‘"></a>æ—‹è½¬è§†é¢‘</h2><p>ffmpeg -i input.mp4 -vf â€œtranspose&#x3D;1â€ output.mp4</p><h2 id="æ‹¼æ¥éŸ³é¢‘"><a href="#æ‹¼æ¥éŸ³é¢‘" class="headerlink" title="æ‹¼æ¥éŸ³é¢‘"></a>æ‹¼æ¥éŸ³é¢‘</h2><p>sox 1.mp3 2.mp3 out.mp3</p><p>è¿™è¾¹æ˜¯å‘ç°ffmpegæ‹¼ä¸èµ·æ¥ï¼Œç„¶åç”¨soxå‘ç°æŠ¥é”™æ˜¯<img src="https://upload-images.jianshu.io/upload_images/12583080-6cb124c9cafb069e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>æ‰€ä»¥è¦è°ƒæ•´ä¸€ä¸‹sample-rateå’Œchannels<br>ffmpeg -i 1.mp3 -ac 1 -ar 16000 out1.mp3</p><h2 id="æ”¹éŸ³é¢‘ä¸º16K"><a href="#æ”¹éŸ³é¢‘ä¸º16K" class="headerlink" title="æ”¹éŸ³é¢‘ä¸º16K"></a>æ”¹éŸ³é¢‘ä¸º16K</h2><p>ffmpeg -i 01.mp3 -acodec pcm_s16le -ac 1 -ar 16000 1.wav</p><h2 id="æ”¹è§†é¢‘size"><a href="#æ”¹è§†é¢‘size" class="headerlink" title="æ”¹è§†é¢‘size"></a>æ”¹è§†é¢‘size</h2><p>ffmpeg -i ziyi_C049_bg_4K.mp4 -vf scale&#x3D;1920:1080 ziyi_C049_bg_1080p.mp4 -hide_banner</p><h2 id="åˆ‡å‰²ç”»é¢"><a href="#åˆ‡å‰²ç”»é¢" class="headerlink" title="åˆ‡å‰²ç”»é¢"></a>åˆ‡å‰²ç”»é¢</h2><p>ffmpeg -i input -vf crop&#x3D;480:480:186:0 output</p><p><a href="https://ask.csdn.net/questions/227737">https://ask.csdn.net/questions/227737</a></p><h2 id="åŠ æ°´å°"><a href="#åŠ æ°´å°" class="headerlink" title="åŠ æ°´å°"></a>åŠ æ°´å°</h2><p><code>ffmpeg -i audio_0_1s.avi -vf &quot;movie=logo.png[watermark];[in][watermark] overlay=main_w-overlay_w-10:main_h-overlay_h-10[out] &quot; output.avi</code></p><h2 id="æ‰¹é‡å¤„ç†"><a href="#æ‰¹é‡å¤„ç†" class="headerlink" title="æ‰¹é‡å¤„ç†"></a>æ‰¹é‡å¤„ç†</h2><p>å‚è€ƒï¼š<a href="https://forum.videohelp.com/threads/356314-How-to-batch-convert-multiplex-any-files-with-ffmpeg">How to batch convert&#x2F;multiplex any files with ffmpeg</a><br>æ”¹äº†ä¸€ä¸ªè„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for %%a in (&quot;*.*&quot;) do ffmpeg -i &quot;%%a&quot; -vf &quot;movie=logo_L.png[watermark];[in][watermark] overlay=0:0[out] &quot; &quot;newfiles\%%~na.mp4&quot;</span><br><span class="line">pause</span><br></pre></td></tr></table></figure><h2 id="åœ¨terminalè¿è¡Œè„šæœ¬"><a href="#åœ¨terminalè¿è¡Œè„šæœ¬" class="headerlink" title="åœ¨terminalè¿è¡Œè„šæœ¬"></a>åœ¨terminalè¿è¡Œè„šæœ¬</h2><p>ä¸Šé¢çš„é“¾æ¥ç”¨çš„æ˜¯.batï¼Œåœ¨linuxéœ€è¦ç”¨shellï¼ˆ<a href="http://c.biancheng.net/shell/">shellå­¦ä¹ æŒ‡å—</a>ï¼‰ç¼–å†™è„šæœ¬ã€‚</p><h3 id="åœ¨terminalè¿è¡Œ-shè„šæœ¬"><a href="#åœ¨terminalè¿è¡Œ-shè„šæœ¬" class="headerlink" title="åœ¨terminalè¿è¡Œ.shè„šæœ¬"></a>åœ¨terminalè¿è¡Œ.shè„šæœ¬</h3><p><a href="http://c.biancheng.net/view/739.html">æ‰§è¡ŒShellè„šæœ¬ï¼ˆå¤šç§æ–¹æ³•ï¼‰</a></p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶test.shï¼Œç„¶åä½¿ç”¨bashå‘½ä»¤è¿è¡Œï¼š<br><code>$ bash test.sh</code></p><h3 id="è¿è¡Œcommand"><a href="#è¿è¡Œcommand" class="headerlink" title="è¿è¡Œcommand"></a>è¿è¡Œcommand</h3><p>åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å¾—çŸ¥commandå’Œscriptä¸å¤ªä¸€æ ·ï¼Œç”¨ä»¥ä¸‹commandæˆåŠŸäº†ï¼š<br><code>for vid in *.avi; do ffmpeg -i &quot;$vid&quot; -vf &quot;movie=logo_L.png[watermark];[in][watermark] overlay=0:0[out] &quot; &quot;$&#123;vid%.*&#125;_logo.avi&quot;; done</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;h2 id=&quot;åˆ‡å‰²éŸ³é¢‘&quot;&gt;&lt;a href=&quot;#åˆ‡å‰²éŸ³é¢‘&quot; class=&quot;headerlink&quot; title=&quot;åˆ‡å‰²éŸ³é¢‘&quot;&gt;&lt;/a&gt;åˆ‡å‰²éŸ³é¢‘&lt;/h2&gt;&lt;p&gt;ffmpeg -i zhaol</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="ffmpeg" scheme="https://tech.konata.co/tags/ffmpeg/"/>
    
    <category term="bash" scheme="https://tech.konata.co/tags/bash/"/>
    
  </entry>
  
  <entry>
    <title>Gitæ“ä½œé€ŸæŸ¥</title>
    <link href="https://tech.konata.co/2019-07-12-git/"/>
    <id>https://tech.konata.co/2019-07-12-git/</id>
    <published>2019-07-12T15:56:59.000Z</published>
    <updated>2022-02-22T16:38:20.441Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="èˆå¼ƒæœ¬åœ°ä¿®æ”¹"><a href="#èˆå¼ƒæœ¬åœ°ä¿®æ”¹" class="headerlink" title="èˆå¼ƒæœ¬åœ°ä¿®æ”¹"></a>èˆå¼ƒæœ¬åœ°ä¿®æ”¹</h1><p><a href="https://www.cnblogs.com/qufanblog/p/7606105.html">git æ’¤é”€ï¼Œæ”¾å¼ƒæœ¬åœ°ä¿®æ”¹</a></p><ol><li><p>æœªaddæ—¶<br><code>git checkout .</code></p></li><li><p>addåï¼Œcommitå‰<br><code>git reset HEAD . </code><br>å›åˆ°1ï¼Œç»§ç»­<br><code>git checkout .</code></p></li><li><p>commitå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br><span class="line">git reset --hard  commitid </span><br></pre></td></tr></table></figure></li></ol><h1 id="å¤„ç†git-pushæ–‡ä»¶è¿‡å¤§çš„åŠæ³•"><a href="#å¤„ç†git-pushæ–‡ä»¶è¿‡å¤§çš„åŠæ³•" class="headerlink" title="å¤„ç†git pushæ–‡ä»¶è¿‡å¤§çš„åŠæ³•"></a>å¤„ç†git pushæ–‡ä»¶è¿‡å¤§çš„åŠæ³•</h1><p>åœ¨è¿›è¡Œgit pushçš„æ—¶å€™ï¼Œé‡åˆ°äº†æŠ¥é”™HTTP 413 curl 22 The requested URL returned error: 413 Request Entity Too Large<br><img src="https://upload-images.jianshu.io/upload_images/12583080-b3197ead790b002d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"><br>æˆ‘è§‰å¾—å¯èƒ½æ˜¯å› ä¸ºä¿å­˜rnnæ¨¡å‹çš„æ–‡ä»¶å¤¹æ¯”è¾ƒå¤§ï¼Œå°±åœ¨.gitignoreåŠ ä¸Šäº†é‚£ä¸ªç›®å½•ã€‚ï¼ˆè®©.gitignoreç”Ÿæ•ˆçš„åŠæ³•ï¼š<a href="https://blog.csdn.net/mingjie1212/article/details/51689606">git ä¿®æ”¹.gitignoreåç”Ÿæ•ˆ</a>ï¼‰ï¼Œç„¶åå†pushè¿˜æ˜¯ä¸è¡Œï¼Œæˆ‘ä¸ç¡®å®šæ˜¯ä¸æ˜¯å› ä¸ºä¹‹å‰commitçš„è¿˜åœ¨ã€‚</p><p>è¿™ä¸ªé”™è¯¯æœ¬èº«æœåˆ°çš„è§£å†³æ–¹æ¡ˆä¸€èˆ¬æ˜¯æé«˜æ–‡ä»¶ä¼ è¾“é™åˆ¶ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘æ˜¯å¸Œæœ›ä¹‹å‰çš„è¾ƒå¤§çš„é‚£ä¸ªcommitä¸è¦è¢«pushä¸Šå»ã€‚äºæ˜¯æˆ‘æœåˆ°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ç”¨git resetï¼š <a href="https://www.cnblogs.com/NewBigLiang/p/7015887.html">git push æ¨é€å¤§æ–‡ä»¶å¤±è´¥çš„å¤„ç†åŠæ³•</a>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå…ˆç”¨git logæŸ¥commitidï¼Œç„¶åç”¨git resetæ’¤é”€commitï¼Œä¹‹åä¿®æ”¹.gitignoreå†ä½¿å…¶ç”Ÿæ•ˆï¼Œæœ€åcommit&amp;pushå³å¯ã€‚</p><p>å¦å¤–ï¼Œresetä¹Ÿå¯ä»¥ç”¨äºå¼ºåˆ¶æ›´æ–°æœ¬åœ°ç‰ˆæœ¬ï¼Œåªéœ€åœ¨git pullå‰è¿è¡Œ</p><p><code>git reset --hard</code></p><p>å³å¯</p><h1 id="ä¿æŒæœ¬åœ°ä»“åº“å’Œè¿œç¨‹åŒæ­¥"><a href="#ä¿æŒæœ¬åœ°ä»“åº“å’Œè¿œç¨‹åŒæ­¥" class="headerlink" title="ä¿æŒæœ¬åœ°ä»“åº“å’Œè¿œç¨‹åŒæ­¥"></a>ä¿æŒæœ¬åœ°ä»“åº“å’Œè¿œç¨‹åŒæ­¥</h1><p>è¿œç¨‹ä»“åº“ï¼Œä¸ªäººforkï¼Œå’Œæœ¬åœ°ä»“åº“çš„é€»è¾‘å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/12583080-86edb36217c60f6e?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p><p>å½“è¿œç¨‹ä»“åº“æ›´æ–°æ—¶ï¼Œéœ€è¦å…ˆæŠŠæ›´æ–°æ‹‰åˆ°æœ¬åœ°ï¼Œåˆå¹¶å¥½åå†pushåˆ°ä¸ªäººforkçš„ä»“åº“ä¸­ã€‚å…·ä½“æµç¨‹ä¸ºï¼š</p><ol><li><p>æ·»åŠ è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°remoteåˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add upstream  http://xxxxxx.git</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å½“å‰ä»“åº“çš„è¿œç¨‹åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure></li><li><p>fetch è¿œç¨‹åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch upstream</span><br></pre></td></tr></table></figure></li><li><p>åˆå¹¶ fetch çš„åˆ†æ”¯åˆ°æœ¬åœ°(æ­¤å¤„åº”è¯¥å’Œdevelopä¿æŒä¸€è‡´ï¼Œæ•…merge developåˆ†æ”¯)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge upstream/develop</span><br></pre></td></tr></table></figure></li><li><p>æ¨é€æœ¬åœ°åˆ°è¿œç¨‹ä»“åº“ï¼ˆè‡ªå·±forkçš„ä»“åº“ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push </span><br></pre></td></tr></table></figure></li></ol><h1 id="æ›´æ”¹è¿œç¨‹ä»“åº“åœ°å€"><a href="#æ›´æ”¹è¿œç¨‹ä»“åº“åœ°å€" class="headerlink" title="æ›´æ”¹è¿œç¨‹ä»“åº“åœ°å€"></a>æ›´æ”¹è¿œç¨‹ä»“åº“åœ°å€</h1><p>å¯¹äºåŸæœ¬å°±æ˜¯cloneçš„repoï¼Œç›´æ¥æ·»åŠ é“¾æ¥ä¼šæŠ¥é”™ï¼Œéœ€è¦åŠ ä¸€å¥git remote rm orgin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote <span class="built_in">rm</span> origin</span><br><span class="line">git remote add origin https://xxx.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;init&quot;</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h1 id="æPR"><a href="#æPR" class="headerlink" title="æPR"></a>æPR</h1><ol><li>fork repo A&#x2F;code åˆ°è‡ªå·±çš„ GitHubï¼Œç§°ä¹‹ä¸º B&#x2F;code</li><li>clone B&#x2F;code åˆ°æœ¬åœ°</li><li>å¢åŠ  A&#x2F;code ä½œä¸ºæœ¬åœ°çš„è¿œç¨‹ upstreamï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add upstream https://github.com/A/code.git</span><br></pre></td></tr></table></figure></li><li>æ–°å»ºå·¥ä½œåˆ†æ”¯<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git  checkout -b my-dev</span><br></pre></td></tr></table></figure></li><li>è¿›è¡Œ addï¼Œcommitï¼Œpush åˆ°è‡ªå·±çš„è¿œç¨‹åˆ†æ”¯ B&#x2F;code<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin my-dev</span><br></pre></td></tr></table></figure></li><li>åœ¨ GitHub ä¸Šå‘èµ· Pull Requestï¼Œä¼šæœ‰åˆ†æ”¯é€‰æ‹©</li></ol><p>è¿™é‡Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆè¦æ·»åŠ  upstream æ ¹æœ¬æ²¡ç”¨åˆ°ï¼Œå¯èƒ½ä¸ºäº†ä¹‹åæ‹‰ä»£ç æ–¹ä¾¿</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;h1 id=&quot;èˆå¼ƒæœ¬åœ°ä¿®æ”¹&quot;&gt;&lt;a href=&quot;#èˆå¼ƒæœ¬åœ°ä¿®æ”¹&quot; class=&quot;headerlink&quot; title=&quot;èˆå¼ƒæœ¬åœ°ä¿®æ”¹&quot;&gt;&lt;/a&gt;èˆå¼ƒæœ¬åœ°ä¿®æ”¹&lt;/h1&gt;&lt;p&gt;&lt;a href</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="git" scheme="https://tech.konata.co/tags/git/"/>
    
    <category term="GitHub" scheme="https://tech.konata.co/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨æœåŠ¡å™¨ç”¨condaåˆ›å»ºpythonç¯å¢ƒ</title>
    <link href="https://tech.konata.co/2019-07-08-conda-create-env/"/>
    <id>https://tech.konata.co/2019-07-08-conda-create-env/</id>
    <published>2019-07-08T15:53:20.000Z</published>
    <updated>2022-02-09T20:45:38.416Z</updated>
    
    <content type="html"><![CDATA[<p>2019å¹´11æœˆ27æ—¥æ›´æ–°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda env export &gt; environment.yml</span><br><span class="line">conda env create -f environment.yml</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¯¼å‡ºenvironmenté…ç½®ç¯å¢ƒï¼š</p><p><a href="https://datascience.stackexchange.com/questions/24093/how-to-clone-python-working-environment-on-another-machine">https://datascience.stackexchange.com/questions/24093/how-to-clone-python-working-environment-on-another-machine</a></p><p>å¦å¤–ï¼Œhome&#x2F;xxx&#x2F;.conda&#x2F;pkgsä¼šä¿å­˜å¾ˆå¤šå®‰è£…åŒ…ï¼Œå¯ä»¥é€šè¿‡ç”¨<code>conda clean -p</code>åˆ é™¤æœªä½¿ç”¨çš„çš„åŒ…(<a href="https://segmentfault.com/q/1010000017438362">https://segmentfault.com/q/1010000017438362</a>)</p><p>åˆ é™¤ç¯å¢ƒï¼šconda remove -n your_env_name â€“all</p><hr><p><a href="http://know.continuum.io/rs/387-XNW-688/images/conda-cheatsheet.pdf">conda cheatsheet</a></p><p>é¦–å…ˆï¼Œå°è¯•conda listï¼Œæç¤ºnot commandï¼Œè§£å†³æ–¹æ³•ï¼š</p><p>åœ¨.bashrc çš„æœ«å°¾æ·»åŠ å¦‚ä¸‹ä¸€è¡Œï¼š</p><p><code>export PATH=/opt/anaconda3/bin/:$PATH</code></p><p>ä¹‹åconda listï¼Œæ­£å¸¸ã€‚</p><p>åˆ›å»ºï¼š</p><p>conda create -n vso python&#x3D;2.7</p><p>æ¿€æ´»ï¼š</p><p>source activate vso</p><p>ç„¶åå°±å¯ä»¥å¼€å§‹å®‰è£…éœ€è¦çš„package</p><p>pip install imutils</p><p>pip install numpy</p><p>pip install opencv-pythonï¼šé‡åˆ°æŠ¥é”™ï¼šlibSM.so.6: cannot open shared object file: No such file or directoryï¼Œè§£å†³æ–¹æ¡ˆï¼š<br>ï¼ˆ<a href="https://blog.csdn.net/liuyingying0418/article/details/84580254">https://blog.csdn.net/liuyingying0418/article/details/84580254</a>ï¼‰</p><p>(pip install opencv-python -i <a href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a>)</p><p>pip install dlibï¼šå®‰è£…dlibçš„æ—¶å€™åˆå‡ºç°äº†cmakeæŠ¥é”™ï¼Œç”¨pip install CMakeï¼Œæå®š</p><p>pip install scipy</p><p>pip install matplotlib</p><p>pip install sklearn</p><p>pip install ffmpeg-normalize</p><p>conda install ffmpeg</p><p>conda install -c conda-forge librosa&#x3D;0.6.3</p><p>conda install x264 ffmpeg -c conda-forgeï¼ˆä¸ºäº†ç”¨h.264ç¼–ç ï¼Œå‚è€ƒï¼š<a href="https://teratail.com/questions/156621">https://teratail.com/questions/156621</a>ï¼‰</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2019å¹´11æœˆ27æ—¥æ›´æ–°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;lin</summary>
      
    
    
    
    <category term="Workshop" scheme="https://tech.konata.co/categories/Workshop/"/>
    
    
    <category term="python" scheme="https://tech.konata.co/tags/python/"/>
    
    <category term="conda" scheme="https://tech.konata.co/tags/conda/"/>
    
  </entry>
  
  <entry>
    <title>pythonå®ç°èšç±»ç®—æ³•</title>
    <link href="https://tech.konata.co/2019-07-08-kmeans/"/>
    <id>https://tech.konata.co/2019-07-08-kmeans/</id>
    <published>2019-07-07T16:19:34.000Z</published>
    <updated>2022-02-09T20:45:45.399Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="sklearnåŒ…ä¸­çš„K-Meansç®—æ³•"><a href="#sklearnåŒ…ä¸­çš„K-Meansç®—æ³•" class="headerlink" title="sklearnåŒ…ä¸­çš„K-Meansç®—æ³•"></a>sklearnåŒ…ä¸­çš„K-Meansç®—æ³•</h1><p>1.Â  å‡½æ•°ï¼š<code>sklearn.cluster.``KMeans</code></p><p>*classÂ *<code>sklearn.cluster.``KMeans</code>(<em>n_clusters&#x3D;8</em>,Â <em>init&#x3D;â€™k-means++â€™</em>,Â <em>n_init&#x3D;10</em>,Â <em>max_iter&#x3D;300</em>,Â <em>tol&#x3D;0.0001</em>,Â <em>precompute_distances&#x3D;â€™autoâ€™</em>,Â <em>verbose&#x3D;0</em>,Â <em>random_state&#x3D;None</em>,Â <em>copy_x&#x3D;True</em>,Â <em>n_jobs&#x3D;None</em>,Â <em>algorithm&#x3D;â€™autoâ€™</em>)</p><ol start="2"><li>ä¸»è¦å‚æ•°</li></ol><p>n_clustersï¼šè¦è¿›è¡Œçš„åˆ†ç±»çš„ä¸ªæ•°ï¼Œå³ä¸Šæ–‡ä¸­kå€¼ï¼Œé»˜è®¤æ˜¯8</p><p>initï¼šâ€˜k-means++â€™, â€˜randomâ€™ or an ndarray</p><p>â€˜k-means ++â€™ï¼šä½¿ç”¨k-means++ç®—æ³•ï¼Œé»˜è®¤é€‰é¡¹</p><p>â€˜randomâ€™:ä»åˆå§‹è´¨å¿ƒæ•°æ®ä¸­éšæœºé€‰æ‹©kä¸ªè§‚å¯Ÿå€¼</p><p>ç¬¬ä¸‰ä¸ªæ˜¯æ•°ç»„å½¢å¼çš„å‚æ•°</p><p><em>n_init</em>ï¼šä½¿ç”¨ä¸åŒçš„åˆå§‹åŒ–è¿è¡Œç®—æ³•çš„æ¬¡æ•°</p><p>max_iter Â ï¼šæœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚é»˜è®¤300</p><p><em>random_stateï¼š</em>è®¾ç½®æŸä¸ªæ•´æ•°ä½¿å¾—ç»“æœå›ºå®š</p><p>n_jobs: è®¾ç½®å¹¶è¡Œé‡Â ï¼ˆ-1è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰CPUï¼‰</p><ol start="3"><li>ä¸»è¦å±æ€§ï¼š</li></ol><p>cluster_centers_ ï¼šé›†ç¾¤ä¸­å¿ƒçš„åæ ‡</p><p>labels_ :Â æ¯ä¸ªç‚¹çš„æ ‡ç­¾</p><ol start="4"><li>å®˜ç½‘ç¤ºä¾‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from sklearn.cluster import KMeans</span><br><span class="line">&gt;&gt;&gt; import numpy as np</span><br><span class="line">&gt;&gt;&gt; X = np.array([[1, 2], [1, 4], [1, 0],</span><br><span class="line">...               [10, 2], [10, 4], [10, 0]])</span><br><span class="line">&gt;&gt;&gt; kmeans = KMeans(n_clusters=2, random_state=0).fit(X)</span><br><span class="line">&gt;&gt;&gt; kmeans.labels_</span><br><span class="line">array([1, 1, 1, 0, 0, 0], dtype=int32)</span><br><span class="line">&gt;&gt;&gt; kmeans.predict([[0, 0], [12, 3]])</span><br><span class="line">array([1, 0], dtype=int32)</span><br><span class="line">&gt;&gt;&gt; kmeans.cluster_centers_</span><br><span class="line">array([[10.,  2.],</span><br><span class="line">       [ 1.,  2.]])</span><br></pre></td></tr></table></figure><p>5.Â  My codeï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from sklearn.cluster import KMeans</span><br><span class="line">import numpy as np</span><br><span class="line">X = np.array([[1, 2], [1, 4], [1, 0], [4, 2], [4, 4], [4, 0]])</span><br><span class="line">plt.plot(X[:,0],X[:,1],&#x27;x&#x27;)</span><br><span class="line">kmeans = KMeans(n_clusters=2).fit(X)</span><br><span class="line">print(kmeans.labels_)</span><br><span class="line">print(kmeans.predict([[0, 0], [4, 4]]))</span><br><span class="line">print(kmeans.cluster_centers_)</span><br></pre></td></tr></table></figure><h1 id="èšç±»ç®—æ³•è¡¡é‡æŒ‡æ ‡"><a href="#èšç±»ç®—æ³•è¡¡é‡æŒ‡æ ‡" class="headerlink" title="èšç±»ç®—æ³•è¡¡é‡æŒ‡æ ‡"></a>èšç±»ç®—æ³•è¡¡é‡æŒ‡æ ‡</h1><p>1.Â  å‡½æ•°ï¼š<code>sklearn.metrics.``silhouette_score</code></p><p><code>sklearn.metrics.``silhouette_score</code>(<em>X</em>,Â <em>labels</em>,Â <em>metric&#x3D;â€™euclideanâ€™</em>,Â <em>sample_size&#x3D;None</em>,Â <em>random_state&#x3D;None</em>,Â **<em>kwds</em>)</p><ol start="2"><li>å®ä¾‹ï¼š</li></ol><p><a href="https://scikit-learn.org/stable/auto_examples/cluster/plot_kmeans_digits.html#sphx-glr-auto-examples-cluster-plot-kmeans-digits-py">https://scikit-learn.org/stable/auto_examples&#x2F;cluster&#x2F;plot_kmeans_digits.html#sphx-glr-auto-examples-cluster-plot-kmeans-digits-py</a></p><h1 id="sklearnåŒ…ä¸­çš„K-Meansç®—æ³•-1"><a href="#sklearnåŒ…ä¸­çš„K-Meansç®—æ³•-1" class="headerlink" title="sklearnåŒ…ä¸­çš„K-Meansç®—æ³•"></a>sklearnåŒ…ä¸­çš„K-Meansç®—æ³•</h1><p>1.Â  å‡½æ•°ï¼š<code>sklearn.mixture.``GaussianMixture</code></p><p><code>sklearn.mixture.``GaussianMixture</code>(<em>n_components&#x3D;1</em>,Â <em>covariance_type&#x3D;â€™fullâ€™</em>,Â <em>tol&#x3D;0.001</em>,Â <em>reg_covar&#x3D;1e-06</em>,Â <em>max_iter&#x3D;100</em>,Â <em>n_init&#x3D;1</em>,Â <em>init_params&#x3D;â€™kmeansâ€™</em>,Â <em>weights_init&#x3D;None</em>,Â <em>means_init&#x3D;None</em>,Â <em>precisions_init&#x3D;None</em>,Â <em>random_state&#x3D;None</em>,Â <em>warm_start&#x3D;False</em>,Â <em>verbose&#x3D;0</em>,Â <em>verbose_interval&#x3D;10</em>)</p><ol start="2"><li>å®ä¾‹ï¼š</li></ol><p><a href="https://scikit-learn.org/stable/auto_examples/mixture/plot_gmm_covariances.html#sphx-glr-auto-examples-mixture-plot-gmm-covariances-py">https://scikit-learn.org/stable/auto_examples&#x2F;mixture&#x2F;plot_gmm_covariances.html#sphx-glr-auto-examples-mixture-plot-gmm-covariances-py</a></p><p><a href="https://scikit-learn.org/stable/auto_examples/mixture/plot_gmm_selection.html#sphx-glr-auto-examples-mixture-plot-gmm-selection-py">https://scikit-learn.org/stable/auto_examples&#x2F;mixture&#x2F;plot_gmm_selection.html#sphx-glr-auto-examples-mixture-plot-gmm-selection-py</a></p><h2 id="èšç±»ç»“æœå¯è§†åŒ–"><a href="#èšç±»ç»“æœå¯è§†åŒ–" class="headerlink" title="èšç±»ç»“æœå¯è§†åŒ–"></a>èšç±»ç»“æœå¯è§†åŒ–</h2><p>å‚è€ƒä»£ç ï¼š<a href="https://scikit-learn.org/stable/auto_examples/cluster/plot_kmeans_digits.html#sphx-glr-auto-examples-cluster-plot-kmeans-digits-py">A demo of K-Means clustering on the handwritten digits data</a><br>ç›´æ¥plotå‡ºæ¥ç‚¹å¤ªå¯†é›†äº†ï¼Œæ‰€ä»¥è€ƒè™‘éšæœºæŠ½å–5kä¸ªç‚¹æ¥plotï¼Œå‚è€ƒï¼š<a href="https://blog.csdn.net/zsc201825/article/details/80918450">np.random.randintã€np.random.choiceã€random.sampleä¸‰ç§éšæœºå‡½æ•°çš„ç”¨æ³•æ¡ˆä¾‹</a><br>ç»“æœå¦‚ä¸‹ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/12583080-5ace24c52806cac3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><h2 id="å…ˆèšç±»åPCA"><a href="#å…ˆèšç±»åPCA" class="headerlink" title="å…ˆèšç±»åPCA"></a>å…ˆèšç±»åPCA</h2><p>ç›´æ¥å¯¹åŸå§‹çš„æ•°æ®è¿›è¡Œèšç±»ï¼Œç»“æœå¦‚ä¸‹ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/12583080-741759f135d8b287.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p><h2 id="Weighted-k-means"><a href="#Weighted-k-means" class="headerlink" title="Weighted k-means"></a>Weighted k-means</h2><h3 id="ç¬¬ä¸€ä¸ªæ–¹æ³•"><a href="#ç¬¬ä¸€ä¸ªæ–¹æ³•" class="headerlink" title="ç¬¬ä¸€ä¸ªæ–¹æ³•"></a>ç¬¬ä¸€ä¸ªæ–¹æ³•</h3><p><a href="https://towardsdatascience.com/clustering-the-us-population-observation-weighted-k-means-f4d58b370002">Clustering the US population: observation-weighted k-means</a><br><a href="https://github.com/leapingllamas/medium_posts/tree/master/observation_weighted_kmeans">github-observation_weighted_kmeans</a></p><p>è¿™æ˜¯ç›´æ¥å¯¹dataåŠ æƒå€¼ï¼Œæœ‰å¯¹åº”çš„ä»£ç ï¼Œä½†æ˜¯æ•°æ®ç»“æ„ç”¨çš„æ˜¯å®ƒè‡ªå·±çš„projectï¼Œéœ€è¦æ”¹å†™ã€‚</p><h3 id="ç¬¬äºŒä¸ªæ–¹æ³•ï¼šweighted-kernel-kmeans"><a href="#ç¬¬äºŒä¸ªæ–¹æ³•ï¼šweighted-kernel-kmeans" class="headerlink" title="ç¬¬äºŒä¸ªæ–¹æ³•ï¼šweighted kernel kmeans"></a>ç¬¬äºŒä¸ªæ–¹æ³•ï¼šweighted kernel kmeans</h3><p><a href="https://www.cnblogs.com/subaiBlog/p/6271315.html">WEIGHTED KERNEL K-MEANS åŠ æƒæ ¸Kå‡å€¼ç®—æ³•ç†è§£åŠå…¶å®ç°ï¼ˆä¸€ï¼‰</a><br>ä¸Šæ–‡ä¸­æåˆ°ï¼Œ[1]ä¸­ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åˆåœ¨[2]æåˆ°ã€‚æœ‰ç°æˆçš„ä»£ç åº“å®ç°ï¼š<br><a href="https://tslearn.readthedocs.io/en/latest/gen_modules/clustering/tslearn.clustering.GlobalAlignmentKernelKMeans.html#tslearn.clustering.GlobalAlignmentKernelKMeans">tslearn.clustering.GlobalAlignmentKernelKMeans</a><br>è¿™ä¸ªæ˜¯ç°æˆçš„å·¥å…·åŒ…ï¼Œè‹¥è¦ç›´æ¥ä½¿ç”¨å¯ä»¥è®¾ç½®ä¸€ä¸ªæœ€ç®€å•çš„y&#x3D;xçš„kernelå³å¯ã€‚</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>[1]<a href="https://www.cs.utexas.edu/users/inderjit/public_papers/multilevel_pami.pdf">Weighted Graph Cuts without Eigenvectors:A Multilevel Approach</a></p><p>[2]<a href="http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=00B899D4EBC282CC18487FE587FAD753?doi=10.1.1.140.3081&rep=rep1&type=pdf">Kernel k-means, Spectral Clustering and Normalized Cuts</a></p><h2 id="èšç±»ç®—æ³•ä¸€è§ˆ"><a href="#èšç±»ç®—æ³•ä¸€è§ˆ" class="headerlink" title="èšç±»ç®—æ³•ä¸€è§ˆ"></a>èšç±»ç®—æ³•ä¸€è§ˆ</h2><p><a href="https://www.cnblogs.com/lc1217/p/6893924.html">https://www.cnblogs.com/lc1217/p/6893924.html</a></p><p><a href="https://www.cnblogs.com/lc1217/p/6908031.html">https://www.cnblogs.com/lc1217/p/6908031.html</a></p><p><a href="https://www.cnblogs.com/lc1217/p/6963687.html">https://www.cnblogs.com/lc1217/p/6963687.html</a></p><h2 id="GMM-vs-K-means"><a href="#GMM-vs-K-means" class="headerlink" title="GMM vs K-means"></a>GMM vs K-means</h2><p><a href="https://www.jianshu.com/p/a4d8fa39c762">https://www.jianshu.com/p/a4d8fa39c762</a></p><p><a href="https://www.jianshu.com/p/13898e68c5c6">https://www.jianshu.com/p/13898e68c5c6</a></p><h2 id="sklearn"><a href="#sklearn" class="headerlink" title="sklearn"></a>sklearn</h2><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html</a></p><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.silhouette_score.html">https://scikit-learn.org/stable/modules/generated/sklearn.metrics.silhouette_score.html</a></p><p><a href="https://scikit-learn.org/stable/auto_examples/cluster/plot_kmeans_digits.html#sphx-glr-auto-examples-cluster-plot-kmeans-digits-py">https://scikit-learn.org/stable/auto_examples&#x2F;cluster&#x2F;plot_kmeans_digits.html#sphx-glr-auto-examples-cluster-plot-kmeans-digits-py</a></p><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.mixture.GaussianMixture.html">https://scikit-learn.org/stable/modules/generated/sklearn.mixture.GaussianMixture.html</a></p><p><a href="https://scikit-learn.org/stable/auto_examples/mixture/plot_gmm_selection.html#sphx-glr-auto-examples-mixture-plot-gmm-selection-py">https://scikit-learn.org/stable/auto_examples&#x2F;mixture&#x2F;plot_gmm_selection.html#sphx-glr-auto-examples-mixture-plot-gmm-selection-py</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;h1 id=&quot;sklearnåŒ…ä¸­çš„K-Meansç®—æ³•&quot;&gt;&lt;a href=&quot;#sklearnåŒ…ä¸­çš„K-Meansç®—æ³•&quot; class=&quot;headerlink&quot; title=&quot;sklearn</summary>
      
    
    
    
    <category term="Algorithm" scheme="https://tech.konata.co/categories/Algorithm/"/>
    
    
    <category term="python" scheme="https://tech.konata.co/tags/python/"/>
    
    <category term="scikit-learn" scheme="https://tech.konata.co/tags/scikit-learn/"/>
    
    <category term="kmeans" scheme="https://tech.konata.co/tags/kmeans/"/>
    
  </entry>
  
  <entry>
    <title>scikit-learnä½¿ç”¨PCAé™ç»´å°ç»“</title>
    <link href="https://tech.konata.co/2018-11-30-pca/"/>
    <id>https://tech.konata.co/2018-11-30-pca/</id>
    <published>2018-11-29T16:19:38.000Z</published>
    <updated>2022-02-09T20:45:31.011Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>æœ¬æ–‡åœ¨ <a href="http://www.cnblogs.com/pinard/p/6239403.html">http://www.cnblogs.com/pinard/p/6239403.html</a> å’Œ <a href="https://www.cnblogs.com/pinard/p/6243025.html">https://www.cnblogs.com/pinard/p/6243025.html</a> çš„å†…å®¹åŸºç¡€ä¸Šåšäº†ä¸€äº›ç¬”è®°å’Œè¡¥å……ï¼Œå¼ºè°ƒäº†æˆ‘è®¤ä¸ºé‡è¦çš„éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€äº›ç»†èŠ‚ä¸å†èµ˜è¿°ã€‚</p><p>Jupiter notebookç‰ˆæœ¬å‚è§æˆ‘çš„github: </p><p><a href="https://github.com/konatasick/machine_learning_note/blob/master/pca.ipynb">https://github.com/konatasick/machine_learning_note/blob/master/pca.ipynb</a></p><h2 id="PCAçš„æ€æƒ³"><a href="#PCAçš„æ€æƒ³" class="headerlink" title="PCAçš„æ€æƒ³"></a>PCAçš„æ€æƒ³</h2><p>PCAï¼ˆPrincipal components analysisï¼Œä¸»æˆåˆ†åˆ†æï¼‰æ˜¯ä¸€ç§é™ç»´ç®—æ³•ï¼Œå®ƒé€šè¿‡ä½¿æ ·æœ¬é—´æ–¹å·®å°½é‡å¤§æ¥å°½å¯èƒ½ä¿ç•™åŸå§‹æ•°æ®çš„ç›¸å…³å…³ç³»ã€‚</p><h2 id="PCAçš„ç®—æ³•"><a href="#PCAçš„ç®—æ³•" class="headerlink" title="PCAçš„ç®—æ³•"></a>PCAçš„ç®—æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1) å¯¹æ‰€æœ‰çš„æ ·æœ¬è¿›è¡Œä¸­å¿ƒåŒ–</span><br><span class="line"></span><br><span class="line">2) è®¡ç®—æ ·æœ¬çš„åæ–¹å·®çŸ©é˜µ</span><br><span class="line"></span><br><span class="line">3) å¯¹åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾å€¼åˆ†è§£</span><br><span class="line"></span><br><span class="line">4ï¼‰å–å‡ºæœ€å¤§çš„mä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡, å°†æ‰€æœ‰çš„ç‰¹å¾å‘é‡æ ‡å‡†åŒ–åï¼Œç»„æˆç‰¹å¾å‘é‡çŸ©é˜µWã€‚</span><br><span class="line"></span><br><span class="line">5ï¼‰å¯¹æ ·æœ¬é›†ä¸­çš„æ¯ä¸€ä¸ªæ ·æœ¬è½¬åŒ–ä¸ºæ–°çš„æ ·æœ¬</span><br></pre></td></tr></table></figure><h2 id="scikit-learnçš„sklearn-decomposition-PCAå‚æ•°ä»‹ç»"><a href="#scikit-learnçš„sklearn-decomposition-PCAå‚æ•°ä»‹ç»" class="headerlink" title="scikit-learnçš„sklearn.decomposition.PCAå‚æ•°ä»‹ç»"></a>scikit-learnçš„sklearn.decomposition.PCAå‚æ•°ä»‹ç»</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html</a></p><p>Parameters:</p><p>n_componentsï¼šè¿™ä¸ªä»£è¡¨äº†éœ€è¦é™ç»´çš„ç»´åº¦ã€‚å½“å®ƒæ˜¯æ•´æ•°æ—¶ï¼Œä»£è¡¨äº†ä¿ç•™çš„ç»´åº¦æ•°é‡ã€‚å½“å®ƒæ˜¯ä¸€ä¸ªä»‹äº0~1ä¹‹é—´çš„æ•°æ—¶ï¼Œä»£è¡¨äº†ä¸»æˆåˆ†çš„æ–¹å·®æ‰€å çš„æœ€å°æ¯”ä¾‹ï¼Œä¾‹å¦‚0.95ä»£è¡¨å–è¶…è¿‡95%çš„é‡çš„ç»´åº¦ã€‚å½“å®ƒä¸ºâ€™mleâ€™;ï¼ŒåŒæ—¶svd_solver &#x3D;&#x3D; â€˜fullâ€™;æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®MLEç®—æ³•è‡ªåŠ¨é€‰æ‹©ç»´åº¦ã€‚ï¼ˆæ­¤æ—¶svd_solver &#x3D;&#x3D; â€˜autoâ€™;å°†ä¼šè¢«è§£è¯»ä¸ºsvd_solver &#x3D;&#x3D; â€˜fullâ€™;ï¼‰</p><p>svd_solverï¼šé»˜è®¤æ˜¯â€™autoâ€™;ï¼Œå³åœ¨å‰©ä¸‹çš„â€™fullâ€™;, â€˜arpackâ€™;, â€˜randomizedâ€™;ä¸­æ ¹æ®æƒ…å†µé€‰ä¸€ä¸ªã€‚â€™fullâ€™;æ˜¯ä¼ ç»Ÿçš„PCAï¼Œâ€™arpackâ€™;, â€˜randomizedâ€™;é€‚ç”¨äºæ•°æ®é‡å¤§çš„åœºæ™¯ï¼Œå…¶åŒºåˆ«åœ¨äºå‰è€…æ˜¯é€šè¿‡scipy.sparse.linalg.svdså®ç°ã€‚</p><p>Attributes*:</p><p>components_ : ä¸»æˆåˆ†çš„æŠ•å½±åæ ‡ï¼Œä»£è¡¨äº†æ•°æ®çš„æœ€å¤§æ–¹å·®çš„æ–¹å‘ï¼Œæ ¹æ®explained_variance_ç”±å¤§åˆ°å°æ’åˆ—ã€‚ç»´åº¦æ˜¯m*nï¼Œå…¶ä¸­næ˜¯åŸå§‹æ•°æ®çš„ç»´åº¦ï¼Œmæ˜¯é™ç»´åçš„ç»´åº¦ã€‚</p><p>explained_variance_å’Œexplained_variance_ratio_ï¼šå‰è€…æ˜¯æ¯ä¸€ç»´çš„æ–¹å·®ï¼Œåè€…æ˜¯æ‰€å æ¯”ä¾‹ï¼š</p><p>explained_variance_ratio_&#x3D;explained_variance&#x2F;sumï¼ˆexplained_variance_ï¼‰</p><p>ç»´åº¦æ˜¯m, å½“m&#x3D;næ—¶ï¼Œsumï¼ˆexplained_variance_ratio_ï¼‰&#x3D;1ã€‚</p><p>mean_ï¼šæ¯ä¸ªfeatureçš„å¹³å‡å€¼ã€‚åœ¨pcaç®—æ³•çš„ç¬¬ä¸€æ­¥ï¼Œéœ€è¦å¯¹featureå½’ä¸€åŒ–ï¼Œæ­¤æ—¶çš„å¹³å‡å€¼ä¿ç•™åœ¨è¿™é‡Œã€‚</p><p>n_components_ï¼šæ¨¡å‹å®é™…çš„é™ç»´æ•°ï¼Œå³mã€‚</p><h2 id="PCAå®ä¾‹"><a href="#PCAå®ä¾‹" class="headerlink" title="PCAå®ä¾‹"></a>PCAå®ä¾‹</h2><p><a href="https://www.cnblogs.com/pinard/p/6243025.html">https://www.cnblogs.com/pinard/p/6243025.html</a> ä¸­ç¤ºèŒƒäº†é™ç»´çš„æ“ä½œã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ç”Ÿæˆéšæœºæ•°æ®å¹¶å¯è§†åŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from mpl_toolkits.mplot3d import Axes3D</span><br><span class="line">%matplotlib inline</span><br><span class="line">from sklearn.datasets.samples_generator import make_blobs</span><br><span class="line"># Xä¸ºæ ·æœ¬ç‰¹å¾ï¼ŒYä¸ºæ ·æœ¬ç°‡ç±»åˆ«ï¼Œ å…±1000ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬3ä¸ªç‰¹å¾ï¼Œå…±4ä¸ªç°‡</span><br><span class="line">X, y = make_blobs(n_samples=10000, n_features=3, centers=[[3,3, 3], [0,0,0], [1,1,1], [2,2,2]], cluster_std=[0.2, 0.1, 0.2, 0.2], </span><br><span class="line">                  random_state =9)</span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = Axes3D(fig, rect=[0, 0, 1, 1], elev=30, azim=20)</span><br><span class="line">plt.scatter(X[:, 0], X[:, 1], X[:, 2],marker=&#x27;o&#x27;)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚å›¾ï¼š</p><p><img src="https://img2018.cnblogs.com/blog/1550156/201811/1550156-20181130104731303-1636187054.png"></p><p>ç°åœ¨æˆ‘ä»¬æ¥è¿›è¡Œé™ç»´ï¼Œä»3ç»´é™åˆ°2ç»´ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.decomposition import PCA</span><br><span class="line">pca = PCA(n_components=2)</span><br><span class="line">pca.fit(X)</span><br><span class="line">X_new = pca.transform(X)</span><br><span class="line">plt.scatter(X_new[:, 0], X_new[:, 1],marker=&#x27;o&#x27;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚å›¾ï¼š</p><p><img src="https://img2018.cnblogs.com/blog/1550156/201811/1550156-20181130104805898-1186449046.png"></p><p>åœ¨å¾ˆå¤šåº”ç”¨ä¸­ï¼Œå½“æˆ‘ä»¬å°†æ•°æ®é™ç»´å¹¶ç”¨äºè®­ç»ƒåï¼Œè®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ä¹‹åçš„è¾“å‡ºä¹Ÿæ˜¯é™ç»´åçš„æ•°æ®ï¼Œéœ€è¦è¿˜åŸå›åŸå§‹ç»´åº¦ã€‚è¿™æ—¶å€™éœ€è¦å°†pcaç®—æ³•è¿›è¡Œé€†è¿ç®—ï¼š</p><p>X_old&#x3D;np.dot(X_new,pca.components_)+pca.mean_</p><p>å³å°†æ–°æ•°æ®å’Œcomponents_ç›¸ä¹˜å¹¶åŠ ä¸Šå¹³å‡å€¼ã€‚</p><p>ä½¿ç”¨ä¸Šæ–‡çš„ä¾‹å­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X_old=np.dot(X_new,pca.components_)+pca.mean_</span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = Axes3D(fig, rect=[0, 0, 1, 1], elev=30, azim=20)</span><br><span class="line">plt.scatter(X_old[:, 0], X_old[:, 1], X_old[:, 2],marker=&#x27;o&#x27;)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚å›¾ï¼š</p><p><img src="https://img2018.cnblogs.com/blog/1550156/201811/1550156-20181130104849634-1533278071.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å³æ˜¯æŠ•å½±åˆ°æœ€å¤§æ–¹å·®æ–¹å‘ä½†å¹¶æœªè¿›è¡Œé™ç»´æ—¶çš„æ ·å­ã€‚</p><p>*parameterçš„å‘½ååé¢æ²¡æœ‰ä¸‹åˆ’çº¿ï¼Œè€Œattributeçš„å‘½ååé¢éƒ½æœ‰ä¸‹åˆ’çº¿ï¼Œä»¥æ­¤åŒºåˆ†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;p&gt;æœ¬æ–‡åœ¨ &lt;a href=&quot;http://www.cnblogs.com/pinard/p/6239403.html&quot;&gt;http://www.cnblogs.com/pinard/p</summary>
      
    
    
    
    <category term="Algorithm" scheme="https://tech.konata.co/categories/Algorithm/"/>
    
    
    <category term="python" scheme="https://tech.konata.co/tags/python/"/>
    
    <category term="scikit-learn" scheme="https://tech.konata.co/tags/scikit-learn/"/>
    
    <category term="PCA" scheme="https://tech.konata.co/tags/PCA/"/>
    
  </entry>
  
</feed>
